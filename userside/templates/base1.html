{% load static %}
<!DOCTYPE html>
<html dir="ltr" lang="zxx">
  <head>
    <!-- Page Title -->
    <title>
      {% block title %}

      {% endblock %}
    </title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="flexkit" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="{% static 'user/assets/images/favicon.png' %}" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" />
    <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Allura&amp;display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'user/assets/css/preloader.css' %}" />


 
    <style>
      .wishlist-amount {
        position: absolute !important;
      
        /* These two properties position the element at the bottom-right */
        bottom: -0.05rem;
        right: 0rem;
      
        /* Keep all your other styling */
        width: 1rem;
        height: 1rem;
        border-radius: 100%;
        background: var(--bs-beige);
        color: #ffffff;
        font-size: 0.625rem;
        line-height: 1rem;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: var(--bs-font-sans-serif);
        font-weight: 400;
      }
      
      //* CSS for Icon Group */
      .search-icon-group {
        position: absolute;
        top: 50%;
        right: 40px;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      /* --- ADD THIS NEW RULE TO FIX THE OVERLAP --- */
      .search-icon-group .btn-icon {
        position: static; /* This is the key change */
      }
      /* Styling for the Image Search Modal */
      #imageSearchModal .modal-content {
        border-radius: 12px;
        border: none;
      }
      #imageSearchModal .modal-header {
        border-bottom: 1px solid #e9ecef;
      }
      #imageSearchModal .modal-title {
        font-weight: 600;
      }
      .upload-zone {
        border: 2px dashed #dee2e6;
        border-radius: 12px;
        padding: 40px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
      }
      .upload-zone:hover,
      .upload-zone.dragover {
        border-color: #007bff;
        background-color: #e9f3ff;
      }
      .upload-zone .upload-icon {
        color: #007bff;
        margin-bottom: 15px;
      }
      .upload-zone p {
        margin-bottom: 0;
      }
      .preview-zone {
        position: relative;
        text-align: center;
        border: 1px solid #dee2e6;
        border-radius: 12px;
        padding: 10px;
        background-color: #f8f9fa;
      }
      #image-preview {
        max-height: 250px;
        max-width: 100%;
        border-radius: 8px;
      }
      .remove-preview-btn {
        position: absolute;
        top: -10px;
        right: -10px;
        background-color: white;
        color: #6c757d;
        border: 1px solid #dee2e6;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        font-size: 1.2rem;
        line-height: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease;
      }
      .remove-preview-btn:hover {
        background-color: #dc3545;
        color: white;
        border-color: #dc3545;
      }
      .search-tips {
        background-color: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        height: 100%;
      }
      .search-tips h6 {
        font-weight: 600;
        margin-bottom: 15px;
      }
      .search-tips ul {
        list-style-type: none;
        padding-left: 0;
      }
      .search-tips li {
        position: relative;
        padding-left: 20px;
        margin-bottom: 10px;
        color: #6c757d;
      }
      .search-tips li::before {
        content: 'âœ“';
        position: absolute;
        left: 0;
        color: #28a745;
      }
      
      #loader-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.85);
        /* Use a high z-index to appear over the modal */
        z-index: 1060;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      
      .spinner {
        border: 8px solid #f3f3f3; /* Light grey */
        border-top: 8px solid #d4af37; /* Gold to match your theme */
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1.5s linear infinite;
      }
      
      #loader-overlay p {
        margin-top: 20px;
        font-family: 'Jost', sans-serif;
        font-size: 1.2em;
        font-weight: 500;
        color: #333;
      }
      
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <!-- CSS Block -->
    {% block css %}

    {% endblock %}
  </head>

  <body>
    <!-- Preloader -->
    <div id="preloader">
      <div class="luxury-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <div class="spinner-center"></div>
      </div>
    </div>
    <div id="loader-overlay" style="display: none;">
      <div class="spinner"></div>
      <p id="loader-text">Processing, please wait...</p>
    </div>
    <!-- Integrating header -->
    {% include 'header.html' %}

    <!-- Integrating alert messages -->
    {% include 'alerts.html' %}

    <!-- Page Content Block -->
    {% block content %}

    {% endblock %}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Integrating footer -->
    {% include 'footer1.html' %}

    <!-- Javascript -->
    {% block script %}

    {% endblock %}
    <div class="modal fade" id="imageSearchModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Search by Image</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-md-7">
                <form id="image-search-form" method="post" action="{% url 'image_search' %}" enctype="multipart/form-data">
                  {% csrf_token %}

                  <div class="upload-zone" id="upload-zone">
                    <div class="upload-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-cloud-arrow-up" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708z" />
                        <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z" />
                      </svg>
                    </div>
                    <p>
                      <strong>Drag & Drop Image Here</strong>
                    </p>
                    <p class="text-secondary">or click to browse files</p>
                  </div>

                  <div class="preview-zone" id="preview-zone" style="display: none;">
                    <img id="image-preview" src="#" alt="Image Preview" />
                    <button type="button" class="remove-preview-btn" id="remove-preview-btn" title="Remove Image">&times;</button>
                  </div>

                  <input id="image-search-input" type="file" name="query_img" accept="image/*" required style="display: none;" />

                  <div class="text-center mt-3">
                    <button type="submit" class="btn btn-primary w-100">Find Similar Products</button>
                  </div>
                </form>
              </div>
              <div class="col-md-5 d-none d-md-block">
                <div class="search-tips">
                  <h6>Tips for Best Results</h6>
                  <ul>
                    <li>Use clear, well-lit images.</li>
                    <li>Focus on a single clothing item.</li>
                    <li>Images with clean backgrounds work best.</li>
                    <li>High-resolution photos provide more detail.</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Preloader Script -->
    <script>
      // --- 1. SCRIPT FOR INITIAL PAGE LOAD PRELOADER ---
      // This handles the spinner that shows when the page first loads.
      window.addEventListener('load', function () {
        const preloader = document.getElementById('preloader')
        if (preloader) {
          preloader.classList.add('hidden')
        }
      })
      
      // --- 2. SCRIPT FOR ALL OTHER ACTIONS (DOM READY) ---
      // This runs once the HTML document is fully loaded.
      document.addEventListener('DOMContentLoaded', function () {
        // --- A. DYNAMIC LOADER LOGIC ---
        // This is the new "smart" loader for forms, buttons, etc.
        const loaderOverlay = document.getElementById('loader-overlay')
        const loaderText = document.getElementById('loader-text')
      
        // Find all elements that should trigger the loader
        const loaderTriggers = document.querySelectorAll('.triggers-loader')
      
        loaderTriggers.forEach((trigger) => {
          // Get the custom message from the element's data attribute
          const message = trigger.dataset.loaderText || 'Processing, please wait...'
      
          // Check if it's a form (use 'submit') or a button/link (use 'click')
          const eventType = trigger.tagName.toLowerCase() === 'form' ? 'submit' : 'click'
      
          trigger.addEventListener(eventType, function () {
            if (loaderText) {
              loaderText.textContent = message // Set the custom message
            }
            if (loaderOverlay) {
              loaderOverlay.style.display = 'flex' // Show the loader
            }
          })
        })
      
        // --- B. IMAGE SEARCH MODAL LOGIC ---
        // This is all your original code for the image search pop-up.
        const modal = document.getElementById('imageSearchModal')
        if (modal) {
          // Only run this code if the modal exists
          const form = modal.querySelector('#image-search-form')
          const input = modal.querySelector('#image-search-input')
          const uploadZone = modal.querySelector('#upload-zone')
          const previewZone = modal.querySelector('#preview-zone')
          const imagePreview = modal.querySelector('#image-preview')
          const removeBtn = modal.querySelector('#remove-preview-btn')
      
          function showPreview(file) {
            const reader = new FileReader()
            reader.onload = function (e) {
              imagePreview.src = e.target.result
              uploadZone.style.display = 'none'
              previewZone.style.display = 'block'
            }
            reader.readAsDataURL(file)
          }
      
          function resetForm() {
            if (form) form.reset()
            if (input) input.value = ''
            if (uploadZone) uploadZone.style.display = 'block'
            if (previewZone) previewZone.style.display = 'none'
            if (imagePreview) imagePreview.src = '#'
          }
      
          // Event listeners for the modal
          if (uploadZone) uploadZone.addEventListener('click', () => input.click())
          if (input)
            input.addEventListener('change', () => {
              if (input.files.length > 0) {
                showPreview(input.files[0])
              }
            })
          if (removeBtn) removeBtn.addEventListener('click', resetForm)
      
          // Drag and Drop functionality
          if (uploadZone) {
            ;['dragenter', 'dragover', 'dragleave', 'drop'].forEach((eventName) => {
              uploadZone.addEventListener(eventName, (e) => {
                e.preventDefault()
                e.stopPropagation()
              })
            })
            ;['dragenter', 'dragover'].forEach((eventName) => {
              uploadZone.addEventListener(eventName, () => uploadZone.classList.add('dragover'))
            })
            ;['dragleave', 'drop'].forEach((eventName) => {
              uploadZone.addEventListener(eventName, () => uploadZone.classList.remove('dragover'))
            })
            uploadZone.addEventListener('drop', (e) => {
              if (e.dataTransfer.files.length > 0) {
                input.files = e.dataTransfer.files
                showPreview(input.files[0])
              }
            })
          }
      
          // Reset form when modal is closed
          modal.addEventListener('hidden.bs.modal', resetForm)
        }
      })
    </script>
  </body>
</html>
