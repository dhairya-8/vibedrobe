{% extends 'base1.html' %}
{% load static %}
{% load product_filters %}
{% block title %}
  Home Page | VibeDrobe
{% endblock %}
{% block css %}
<link rel="stylesheet" href="{% static 'user/assets/css/plugins/swiper.min.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'user/assets/css/style.css' %}" type="text/css">

<style>
  /* Replace the existing .pc__img-wrapper and related styles with this improved version */
  .pc__img-wrapper {
    height: 300px; /* Maintain fixed height for consistency */
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    background-color: #ffffffff; /* Add a neutral background for better appearance f8f8f8*/
  }
  
  .pc__img {
    width: auto;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Changed from cover to contain to show full image */
    transition: opacity 0.3s ease;
  }
  
  .pc__img-second {
    position: absolute;
    top: 0;
    left: 0;
    width: auto;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Changed from cover to contain */
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .pc__img-wrapper:hover .pc__img:first-child {
    opacity: 0;
  }
  
  .pc__img-wrapper:hover .pc__img-second {
    opacity: 1;
  }

  /* Keep your existing wishlist button styles */
  .product-card {
    position: relative;
  }
  
  .pc__info {
    position: relative;
    padding-top: 30px;
  }
  
  .wishlist-form {
    position: absolute;
    top: 5px;
    right: 5px;
    z-index: 100;
    margin: 0;
    padding: 0;
  }
  
  .wishlist-btn {
    background: transparent;
    border: none;
    padding: 8px;
    cursor: pointer;
    border-radius: 50%;
    transition: background-color 0.3s;
  }
  
  .wishlist-btn:hover {
    background-color: rgba(0,0,0,0.05);
  }
  
  .wishlist-btn svg {
    width: 18px;
    height: 18px;
    display: block;
  }
  
  form.wishlist-form {
    display: inline;
    line-height: normal;
  }
</style>
{% endblock %}

{% block content %}
  <main>
    <section class="swiper-container js-swiper-slider slideshow full-width_padding"
      data-settings='{
        "autoplay": {
          "delay": 5000
        },
        "slidesPerView": 1,
        "effect": "fade",
        "loop": true,
        "pagination": {
          "el": ".slideshow-pagination",
          "type": "bullets",
          "clickable": true
        }
      }'>
      <div class="swiper-wrapper">
        <div class="swiper-slide full-width_border border-1" style="border-color: #f5e6e0;">
          <div class="overflow-hidden position-relative h-100">
            <div class="slideshow-bg" style="background-color: #f5e6e0;">
              <img loading="lazy" src="{% static 'user/assets/images/slideshow-pattern.png' %}" width="1761" height="778" alt="Pattern" class="slideshow-bg__img object-fit-cover">
            </div>
            <div class="slideshow-character position-absolute bottom-0 pos_right-center">
              <img loading="lazy" src="{% static 'user/assets/images/slideshow-character2.png' %}" width="400" height="733" alt="Woman Fashion 1" class="slideshow-character__img animate animate_fade animate_btt animate_delay-9 h-auto w-auto">
              <div class="character_markup">
                <p class="text-uppercase font-sofia fw-bold animate animate_fade animate_rtl animate_delay-10">Summer</p>
              </div>
            </div>
            <div class="slideshow-text container position-absolute start-50 top-50 translate-middle">
              <h6 class="text_dash text-uppercase text-red fs-base fw-medium animate animate_fade animate_btt animate_delay-3">New Trend</h6>
              <h2 class="text-uppercase h1 fw-normal mb-0 animate animate_fade animate_btt animate_delay-5">Summer Sale Stylish</h2>
              <h2 class="text-uppercase h1 fw-bold animate animate_fade animate_btt animate_delay-5">Womens</h2>
              <a href="{% url 'shop' %}?gender=Female" class="btn-link btn-link_lg default-underline text-uppercase fw-medium animate animate_fade animate_btt animate_delay-7">Discover More</a>
            </div>
          </div>
        </div><div class="swiper-slide full-width_border border-1" style="border-color: #f5e6e0;">
          <div class="overflow-hidden position-relative h-100">
            <div class="slideshow-bg" style="background-color: #f5e6e0;">
              <img loading="lazy" src="{% static 'user/assets/images/slideshow-pattern.png' %}" width="1761" height="778" alt="Pattern" class="slideshow-bg__img object-fit-cover">
            </div>
            <div class="slideshow-character position-absolute bottom-0 pos_right-center">
              <img loading="lazy" src="{% static 'user/assets/images/char.png' %}" width="400" height="690" alt="Woman Fashion 2" class="slideshow-character__img animate animate_fade animate_rtl animate_delay-10 h-auto w-auto">
            </div>
            <div class="slideshow-text container position-absolute start-50 top-50 translate-middle">
              <h6 class="text_dash text-uppercase text-red fs-base fw-medium animate animate_fade animate_btt animate_delay-3">Summer 2020</h6>
              <h2 class="text-uppercase h1 fw-bold animate animate_fade animate_btt animate_delay-3">Hello New Season</h2>
              <h6 class="text-uppercase mb-5 animate animate_fade animate_btt animate_delay-3">Limited Time Offer - Up to 60% off & Free Shipping</h6>
              <a href="#" class="btn-link btn-link_lg default-underline text-uppercase fw-medium animate animate_fade animate_btt animate_delay-3">Discover More</a>
            </div>
          </div>
        </div></div><div class="container">
        <div class="slideshow-pagination d-flex align-items-center position-absolute bottom-0 mb-5"></div>
      </div><a href="#section-collections-grid_masonry" class="slideshow-scroll d-none d-xxl-block position-absolute end-0 bottom-0 text_dash text-uppercase fw-medium">Scroll</a>
    </section>
    
    <div class="mb-5 pb-5"></div>
    <div class="pb-1"></div>

    <section class="collections-grid collections-grid_masonry" id="section-collections-grid_masonry">
      <div class="container h-md-100">
        <div class="row h-md-100">
          <div class="col-lg-6 h-md-100">
            <div class="collection-grid__item position-relative h-md-100">
              <div class="background-img" style="background-image: url('{% static 'user/assets/images/collection_grid_1.jpg' %}');"></div>
              <div class="content_abs content_bottom content_left content_bottom-md content_left-md">
                <p class="text-uppercase mb-1">Hot List</p>
                <h3 class="text-uppercase"><strong>Women</strong> Collection</h3>
                <a href="{% url 'shop' %}?gender=Female" class="btn-link default-underline text-uppercase fw-medium">Shop Now</a>
              </div>
            </div>
          </div>

          <div class="col-lg-6 d-flex flex-column">
            <div class="collection-grid__item position-relative flex-grow-1 mb-lg-4">
              <div class="background-img" style="background-image: url('{% static 'user/assets/images/collection_grid_2.jpg' %}');"></div>
              <div class="content_abs content_bottom content_left content_bottom-md content_left-md">
                <p class="text-uppercase mb-1">Hot List</p>
                <h3 class="text-uppercase"><strong>Men</strong> Collection</h3>
                <a href="{% url 'shop' %}?gender=Male" class="btn-link default-underline text-uppercase fw-medium">Shop Now</a>
              </div>
            </div>
            <div class="position-relative flex-grow-1 mt-lg-1">
              <div class="row h-md-100">
                <div class="col-md-6 h-md-100">
                  <div class="collection-grid__item h-md-100 position-relative">
                    <div class="background-img" style="background-image: url('{% static 'user/assets/images/collection_grid_3.jpg' %}');"></div>
                    <div class="content_abs content_bottom content_left content_bottom-md content_left-md">
                      <p class="text-uppercase mb-1">Hot List</p>
                      <h3 class="text-uppercase"><strong>Kids</strong> Collection</h3>
                      <a href="#" class="btn-link default-underline text-uppercase fw-medium">Shop Now</a>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 h-md-100">
                  <div class="collection-grid__item h-md-100 position-relative">
                    <div class="background-img" style="background-color: #f5e6e0"></div>
                    <div class="content_abs content_bottom content_left content_bottom-md content_left-md">
                      <h3 class="text-uppercase"><strong>E-Gift</strong> Cards</h3>
                      <p class="mb-1">Surprise someone with the gift they<br>really want.</p>
                      <a href="#" class="btn-link default-underline text-uppercase fw-medium">Shop Now</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="mb-4 pb-4 mb-xl-5 pb-xl-5"></div>

    <section class="products-grid container">
      <h2 class="section-title text-uppercase text-center mb-1 mb-md-3 pb-xl-2 mb-xl-4">Our Trendy <strong>Products</strong></h2>

      <ul class="nav nav-tabs mb-3 text-uppercase justify-content-center" id="collections-tab" role="tablist">
        <li class="nav-item" role="presentation">
          <a class="nav-link nav-link_underscore active" id="collections-tab-1-trigger" data-bs-toggle="tab" href="#collections-tab-1" role="tab" aria-controls="collections-tab-1" aria-selected="true">All</a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link nav-link_underscore" id="collections-tab-2-trigger" data-bs-toggle="tab" href="#collections-tab-2" role="tab" aria-controls="collections-tab-2" aria-selected="false">New Arrivals</a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link nav-link_underscore" id="collections-tab-3-trigger" data-bs-toggle="tab" href="#collections-tab-3" role="tab" aria-controls="collections-tab-3" aria-selected="false">Best Seller</a>
        </li>
        <li class="nav-item" role="presentation">
          <a class="nav-link nav-link_underscore" id="collections-tab-4-trigger" data-bs-toggle="tab" href="#collections-tab-4" role="tab" aria-controls="collections-tab-4" aria-selected="false">Top Rated</a>
        </li>
      </ul>

      <div class="tab-content pt-2" id="collections-tab-content">
        <div class="tab-pane fade show active" id="collections-tab-1" role="tabpanel" aria-labelledby="collections-tab-1-trigger">
          <div class="row">
            {% for product in all_products %}
            <div class="col-6 col-md-4 col-lg-3">
              <div class="product-card mb-3 mb-md-4 mb-xxl-5">
                <div class="pc__img-wrapper">
                  <a href="{% url 'product_detail' product.id %}">
                  {% if product.base_image %}
                      <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img">
                    {% else %}
                      <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img">
                    {% endif %}
                    
                    {% comment %} Show the second gallery image instead of the last {% endcomment %}
                    {% with gallery_images=product.product_gallery_set.all %}
                      {% if gallery_images|length >= 2 %}
                        {% comment %} Get the second image (index 1) {% endcomment %}
                        <img loading="lazy" src="{{ gallery_images.1.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% elif gallery_images|length == 1 %}
                        {% comment %} If only one gallery image exists, use it {% endcomment %}
                        <img loading="lazy" src="{{ gallery_images.0.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% else %}
                        {% comment %} If no gallery images, use base image again {% endcomment %}
                        {% if product.base_image %}
                          <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                        {% else %}
                          <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img pc__img-second">
                        {% endif %}
                      {% endif %}
                    {% endwith %}
                  </a>
                  <form action="{% url 'quick_add_to_cart_home' product.id %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="pc__atc btn anim_appear-bottom btn position-absolute border-0 text-uppercase fw-medium" title="Add To Cart">
                      Add To Cart
                    </button>
                  </form>              
                  </div>
                <div class="pc__info position-relative">
                  <p class="pc__category">{{ product.subcategory_id.name }}</p>
                  <h6 class="pc__title"><a href="#">{{ product.name|truncatechars:40 }}</a></h6>
                  <div class="product-card__price d-flex">
                    <span class="money price">₹{{ product.price|floatformat:2 }}</span>
                  </div>
                  {% if product.review_set.count > 0 %}
                  <div class="product-card__review d-flex align-items-center">
                    <span class="reviews-note text-lowercase text-secondary ms-1">{{ product.review_set.count }} review{{ product.review_set.count|pluralize }}</span>
                  </div>
                  {% endif %}
                  <form action="{% url 'quick_add_to_wishlist_home' product.id %}" method="POST" class="wishlist-form">
                    {% csrf_token %}
                    <button type="submit" class="wishlist-btn" title="Add To Wishlist">
                      <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <use href="#icon_heart" />
                      </svg>
                    </button>
                  </form>
                </div>
              </div>
            </div>
            {% empty %}
              <p class="text-center">No products found.</p>
            {% endfor %}
          </div>
          <div class="text-center mt-2">
            <a class="btn-link btn-link_lg default-underline text-uppercase fw-medium" href="{% url 'shop' %}">Discover More</a>
          </div>
        </div>

        <div class="tab-pane fade" id="collections-tab-2" role="tabpanel" aria-labelledby="collections-tab-2-trigger">
          <div class="row">
            {% for product in new_arrivals %}
            <div class="col-6 col-md-4 col-lg-3">
              <div class="product-card mb-3 mb-md-4 mb-xxl-5">
                <div class="pc__img-wrapper">
                  <a href="{% url 'product_detail' product.id %}">
                 {% if product.base_image %}
                      <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img">
                    {% else %}
                      <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img">
                    {% endif %}
                    
                    {% with gallery_images=product.product_gallery_set.all %}
                      {% if gallery_images|length >= 2 %}
                        <img loading="lazy" src="{{ gallery_images.1.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% elif gallery_images|length == 1 %}
                        <img loading="lazy" src="{{ gallery_images.0.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% else %}
                        {% if product.base_image %}
                          <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                        {% else %}
                          <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img pc__img-second">
                        {% endif %}
                      {% endif %}
                    {% endwith %}
                  </a>
                  <form action="{% url 'quick_add_to_cart_home' product.id %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="pc__atc btn anim_appear-bottom btn position-absolute border-0 text-uppercase fw-medium" title="Add To Cart">
                      Add To Cart
                    </button>
                  </form>                </div>
                <div class="pc__info position-relative">
                  <p class="pc__category">{{ product.subcategory_id.name }}</p>
                  <h6 class="pc__title"><a href="#">{{ product.name|truncatechars:40 }}</a></h6>
                  <div class="product-card__price d-flex">
                    <span class="money price">₹{{ product.price|floatformat:2 }}</span>
                  </div>
                  <form action="{% url 'quick_add_to_wishlist_home' product.id %}" method="POST" class="wishlist-form">
                    {% csrf_token %}
                    <button type="submit" class="wishlist-btn" title="Add To Wishlist">
                      <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <use href="#icon_heart" />
                      </svg>
                    </button>
                  </form>
                </div>
              </div>
            </div>
            {% empty %}
              <p class="text-center">No new arrivals found.</p>
            {% endfor %}
          </div>
        </div>

        <div class="tab-pane fade" id="collections-tab-3" role="tabpanel" aria-labelledby="collections-tab-3-trigger">
           <div class="row">
            {% for product in best_sellers %}
            <div class="col-6 col-md-4 col-lg-3">
              <div class="product-card mb-3 mb-md-4 mb-xxl-5">
                <div class="pc__img-wrapper">
                  <a href="{% url 'product_detail' product.id %}">
                  {% if product.base_image %}
                      <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img">
                    {% else %}
                      <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img">
                    {% endif %}
                    
                    {% with gallery_images=product.product_gallery_set.all %}
                      {% if gallery_images|length >= 2 %}
                        <img loading="lazy" src="{{ gallery_images.1.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% elif gallery_images|length == 1 %}
                        <img loading="lazy" src="{{ gallery_images.0.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% else %}
                        {% if product.base_image %}
                          <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                        {% else %}
                          <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img pc__img-second">
                        {% endif %}
                      {% endif %}
                    {% endwith %}
                  </a>
                  <form action="{% url 'quick_add_to_cart_home' product.id %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="pc__atc btn anim_appear-bottom btn position-absolute border-0 text-uppercase fw-medium" title="Add To Cart">
                      Add To Cart
                    </button>
                  </form>                </div>
                <div class="pc__info position-relative">
                  <p class="pc__category">{{ product.subcategory_id.name }}</p>
                  <h6 class="pc__title"><a href="#">{{ product.name|truncatechars:40 }}</a></h6>
                  <div class="product-card__price d-flex">
                    <span class="money price">₹{{ product.price|floatformat:2 }}</span>
                  </div>
                  <form action="{% url 'quick_add_to_wishlist_home' product.id %}" method="POST" class="wishlist-form">
                    {% csrf_token %}
                    <button type="submit" class="wishlist-btn" title="Add To Wishlist">
                      <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <use href="#icon_heart" />
                      </svg>
                    </button>
                  </form>
                </div>
              </div>
            </div>
            {% empty %}
              <p class="text-center">No best sellers found.</p>
            {% endfor %}
          </div>
        </div>

        <div class="tab-pane fade" id="collections-tab-4" role="tabpanel" aria-labelledby="collections-tab-4-trigger">
          <div class="row">
            {% for product in top_rated %}
            <div class="col-6 col-md-4 col-lg-3">
              <div class="product-card mb-3 mb-md-4 mb-xxl-5">
                <div class="pc__img-wrapper">
                  <a href="{% url 'product_detail' product.id %}">
                  {% if product.base_image %}
                      <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img">
                    {% else %}
                      <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img">
                    {% endif %}
                    
                    {% with gallery_images=product.product_gallery_set.all %}
                      {% if gallery_images|length >= 2 %}
                        <img loading="lazy" src="{{ gallery_images.1.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% elif gallery_images|length == 1 %}
                        <img loading="lazy" src="{{ gallery_images.0.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% else %}
                        {% if product.base_image %}
                          <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                        {% else %}
                          <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img pc__img-second">
                        {% endif %}
                      {% endif %}
                    {% endwith %}
                  </a>
                  <form action="{% url 'quick_add_to_cart_home' product.id %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="pc__atc btn anim_appear-bottom btn position-absolute border-0 text-uppercase fw-medium" title="Add To Cart">
                      Add To Cart
                    </button>
                  </form>                </div>
                <div class="pc__info position-relative">
                  <p class="pc__category">{{ product.subcategory_id.name }}</p>
                  <h6 class="pc__title"><a href="#">{{ product.name|truncatechars:40 }}</a></h6>
                  <div class="product-card__price d-flex">
                    <span class="money price">₹{{ product.price|floatformat:2 }}</span>
                  </div>
                  <form action="{% url 'quick_add_to_wishlist_home' product.id %}" method="POST" class="wishlist-form">
                    {% csrf_token %}
                    <button type="submit" class="wishlist-btn" title="Add To Wishlist">
                      <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <use href="#icon_heart" />
                      </svg>
                    </button>
                  </form>
                </div>
              </div>
            </div>
            {% empty %}
              <p class="text-center">No top rated products found.</p>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>

    <div class="mb-5 pb-1 pb-xl-5"></div>

     <section class="deal-timer position-relative d-flex align-items-end overflow-hidden" style="background-color: #ebebeb;">
      <div class="background-img" style="background-image: url('{% static 'user/assets/images/ethnic.png' %}');"></div>

      <div class="deal-timer-wrapper container position-relative">
        <div class="deal-timer__content pb-2 mb-3 pb-xl-5 mb-xl-3 mb-xxl-5">
          <p class="text_dash text-uppercase text-red fw-medium">Best collection so far</p>
          <h3 class="h1 text-uppercase"><strong>Ethnic</strong> Collection</h3>
            <a href="{% url 'shop' %}?category={{ ethnic_category.id }}" class="btn-link default-underline text-uppercase fw-medium mt-3">Shop Now</a>
        </div>
      </div><!-- /.deal-timer-wrapper -->
    </section><!-- /.deal-timer -->
    
    <div class="mb-5 pb-1 pb-xl-5"></div>
    
    <section class="grid-banner container mb-3">
      <div class="row">
        <div class="col-md-6">
          <div class="grid-banner__item grid-banner__item_rect position-relative">
            <div class="background-img" style="background-image: url('{% static 'user/assets/images/banner_1.jpg' %}');"></div>
            <div class="content_abs content_bottom content_left content_bottom-lg content_left-lg">
               {% if tshirts_min_price %}
                    <h6 class="text-uppercase text-white fw-medium mb-3">Starting At ₹{{ tshirts_min_price|floatformat:0 }}</h6>
                    {% endif %}
              <h3 class="text-white mb-3">Women's T-Shirts</h3>
                <a href="{% url 'shop' %}?subcategory={{ tshirts_subcategory.id }}&gender=Female" class="btn-link default-underline text-uppercase text-white fw-medium">Shop Now</a>
            </div><!-- /.content_abs content_bottom content_left content_bottom-md content_left-md -->
          </div>
        </div><!-- /.col-md-6 -->

        <div class="col-md-6">
          <div class="grid-banner__item grid-banner__item_rect position-relative">
            <div class="background-img" style="background-image: url('{% static 'user/assets/images/banner_2.jpg' %}');"></div>
            <div class="content_abs content_bottom content_left content_bottom-lg content_left-lg">
              {% if jackets_min_price %}
                    <h6 class="text-uppercase fw-medium mb-3">Starting At ₹{{ jackets_min_price|floatformat:0 }}</h6>
                    {% endif %}
              <h3 class="mb-3">Men's Jackets</h3>
                <a href="{% url 'shop' %}?subcategory={{ jackets_subcategory.id }}&gender=Male" class="btn-link default-underline text-uppercase fw-medium">Shop Now</a>
            </div><!-- /.content_abs content_bottom content_left content_bottom-md content_left-md -->
          </div>
        </div><!-- /.col-md-6 -->
      </div><!-- /.row -->
    </section><!-- /.grid-banner container -->
    
    <div class="mb-5 pb-1 pb-xl-4"></div>

    <section class="products-carousel container">
      <h2 class="section-title text-uppercase text-center mb-4 pb-xl-2 mb-xl-4">Limited <strong>Edition</strong></h2>
      <div id="product_carousel" class="position-relative">
        <div class="swiper-container js-swiper-slider"
          data-settings='{
            "autoplay": {"delay": 5000},
            "slidesPerView": 4, "slidesPerGroup": 4, "effect": "none", "loop": true,
            "pagination": {"el": "#product_carousel .products-pagination", "type": "bullets", "clickable": true},
            "navigation": {"nextEl": "#product_carousel .products-carousel__next", "prevEl": "#product_carousel .products-carousel__prev"},
            "breakpoints": {
              "320": {"slidesPerView": 2, "slidesPerGroup": 2, "spaceBetween": 14},
              "768": {"slidesPerView": 3, "slidesPerGroup": 3, "spaceBetween": 24},
              "992": {"slidesPerView": 4, "slidesPerGroup": 1, "spaceBetween": 30}
            }
          }'>
          <div class="swiper-wrapper">
            {% for product in limited_edition_products %}
            <div class="swiper-slide product-card">
              <div class="pc__img-wrapper">
                <a href="{% url 'product_detail' product.id %}">
                   {% if product.base_image %}
                      <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img">
                    {% else %}
                      <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img">
                    {% endif %}
                    
                    {% with gallery_images=product.product_gallery_set.all %}
                      {% if gallery_images|length >= 2 %}
                        <img loading="lazy" src="{{ gallery_images.1.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% elif gallery_images|length == 1 %}
                        <img loading="lazy" src="{{ gallery_images.0.image_path.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                      {% else %}
                        {% if product.base_image %}
                          <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img pc__img-second">
                        {% else %}
                          <img loading="lazy" src="{% static 'path/to/default-image.jpg' %}" alt="Default Image" class="pc__img pc__img-second">
                        {% endif %}
                      {% endif %}
                    {% endwith %}
                </a>
                <form action="{% url 'quick_add_to_cart_home' product.id %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="pc__atc btn anim_appear-bottom btn position-absolute border-0 text-uppercase fw-medium" title="Add To Cart">
                      Add To Cart
                    </button>
                  </form>
              </div>
              <div class="pc__info position-relative">
                <p class="pc__category">{{ product.subcategory_id.name }}</p>
                <h6 class="pc__title"><a href="#">{{ product.name|truncatechars:40 }}</a></h6>
                <div class="product-card__price d-flex">
                  <span class="money price">₹{{ product.price|floatformat:2 }}</span>
                </div>
                <form action="{% url 'quick_add_to_wishlist_home' product.id %}" method="POST" class="wishlist-form">
                    {% csrf_token %}
                    <button type="submit" class="wishlist-btn" title="Add To Wishlist">
                      <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <use href="#icon_heart" />
                      </svg>
                    </button>
                  </form>
              </div>
            </div>
            {% empty %}
             {% endfor %}
          </div></div><div class="products-carousel__prev position-absolute top-50 d-flex align-items-center justify-content-center">
          <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><use href="#icon_prev_md" /></svg>
        </div>
        <div class="products-carousel__next position-absolute top-50 d-flex align-items-center justify-content-center">
          <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><use href="#icon_next_md" /></svg>
        </div>
        <div class="products-pagination mt-4 mb-5 d-flex align-items-center justify-content-center"></div>
      </div>
    </section>

    <section class="instagram container">
      </section>

    <div class="mb-4 pb-4 pb-xl-5 mb-xl-5"></div>
    
    <section class="service-promotion container mb-md-4 pb-md-4 mb-xl-5">
      </section>
  </main>
{% endblock %}

{% block script %}
  <script src="{% static 'user/assets/js/plugins/jquery.min.js' %}"></script>
  <script src="{% static 'user/assets/js/plugins/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'user/assets/js/plugins/bootstrap-slider.min.js' %}"></script>
  <script src="{% static 'user/assets/js/plugins/swiper.min.js' %}"></script>
  <script src="{% static 'user/assets/js/plugins/countdown.js' %}"></script>
  <script src="{% static 'user/assets/js/theme.js' %}"></script>

   <script>
    $(document).ready(function() {
      // Check if we need to open the cart drawer
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('open_cart_drawer') === 'true') {
        // Trigger the cart drawer opening
        $('.js-open-aside[data-aside="cartDrawer"]').trigger('click');
        
        // Clean the URL
        const cleanUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
        window.history.replaceState({}, document.title, cleanUrl);
      }
    });
  </script>
{% endblock %}