{% extends 'base1.html' %}
{% load custom_filters %}
{% load product_filters %}
{% load static %}

{% block title %}{{ product.name }} | VibeDrobe{% endblock %}

{% block css %}
<!-- Stylesheets -->
<link rel="stylesheet" href="{% static 'user/assets/css/plugins/swiper.min.css' %}">
<link rel="stylesheet" href="{% static 'user/assets/css/plugins/jquery.fancybox.css' %}">
<link rel="stylesheet" href="{% static 'user/assets/css/style.css' %}">

<style>
  .swatch-list .swatch.active {
    border-color: #000;
    background-color: #f5f5f5;
}

.products-carousel .pc__img-wrapper {
    height: 300px; /* Fixed height for consistency */
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    background-color: #ffffffff; /* Neutral background for better appearance */
  }
  
  .products-carousel .pc__img {
    width: auto;
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Changed from cover to contain to show full image */
  }

  .size-guide .table {
  font-size: 0.9rem;
  margin-bottom: 0;
}

.size-guide .table th, 
.size-guide .table td {
  padding: 8px 5px;
}

.composition-care-wrapper .card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  border-radius: 12px;
}

.composition-care-wrapper .card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
}

.bg-opacity-10 {
  background-color: rgba(var(--bs-primary-rgb), 0.1) !important;
}

.composition-care-wrapper .bi {
  font-size: 1.1em;
}

.small {
  font-size: 0.875rem;
}
</style>
<style>
.fbt-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    padding: 3rem 0;
    border-radius: 20px;
    margin-top: 2rem;
}

.fbt-header {
    position: relative;
}

.fbt-product-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
    position: relative;
    border: 2px solid transparent;
}

.fbt-product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
}

.fbt-product-card.featured {
    border-color: #007bff;
    background: linear-gradient(135deg, #ffffff 0%, #f8fbff 100%);
}

.fbt-product-card.selectable {
    cursor: pointer;
}

.fbt-product-card.selectable:hover {
    border-color: #dee2e6;
}

.product-badge {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    background: #007bff;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    white-space: nowrap;
}

.selected-badge {
    background: #28a745;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 500;
}

.product-checkbox {
    position: absolute;
    top: 12px;
    left: 12px;
    z-index: 2;
}

.product-checkbox input[type="checkbox"] {
    display: none;
}

.product-checkbox label {
    width: 20px;
    height: 20px;
    border: 2px solid #dee2e6;
    border-radius: 4px;
    background: white;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
}

.product-checkbox input[type="checkbox"]:checked + label {
    background: #007bff;
    border-color: #007bff;
}

.product-checkbox input[type="checkbox"]:checked + label:after {
    content: 'âœ“';
    position: absolute;
    color: white;
    font-size: 12px;
    font-weight: bold;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.product-image {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background: #f8f9fa;
    margin-bottom: 1rem;
}

.product-image img {
    width: 100%;
    height: 180px;
    object-fit: contain;
    transition: transform 0.3s ease;
}

.fbt-product-card:hover .product-image img {
    transform: scale(1.05);
}

.product-quick-view {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 32px;
    height: 32px;
    background: rgba(255,255,255,0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.3s ease;
    text-decoration: none;
    color: #333;
}

.fbt-product-card:hover .product-quick-view {
    opacity: 1;
}

.product-name {
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: 0.5rem;
}

.product-actions {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-quantity {
    width: 28px;
    height: 28px;
    border: 1px solid #dee2e6;
    background: white;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    transition: all 0.2s ease;
}

.btn-quantity:hover {
    background: #f8f9fa;
    border-color: #007bff;
}

.quantity-input {
    width: 40px;
    height: 28px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    text-align: center;
    font-size: 12px;
}

.fbt-connector {
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
}

.plus-icon {
    width: 48px;
    height: 48px;
    background: #007bff;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 1rem 0;
    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
}

.connector-line {
    flex: 1;
    width: 2px;
    background: linear-gradient(to bottom, #007bff, #dee2e6);
    border-radius: 1px;
}

.fbt-summary {
    border-top: 1px solid #e9ecef;
    padding-top: 2rem;
}

.summary-card {
    background: white !important;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    border: 1px solid #e9ecef;
}

.bundle-actions .btn {
    padding: 12px 24px;
    font-weight: 600;
    border-radius: 12px;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .fbt-section {
        padding: 2rem 1rem;
        border-radius: 16px;
    }
    
    .fbt-product-card {
        padding: 1rem;
    }
    
    .fbt-connector {
        display: none;
    }
    
    .bundle-actions .btn {
        width: 100%;
        margin-bottom: 1rem;
    }
    
    .product-image img {
        height: 140px;
    }
}
</style>


{% endblock %}

{% block content %}
  <main>
    <section class="product-single product-single__type-6 container">
      <div class="row">
        <div class="col-lg-7">
          <div class="mb-md-1 pb-md-3"></div>
          <div class="product-single__media" data-media-type="list-image">
            <div class="product-single__image d-flex flex-column gap-2">
              <div class="product-single__image-item">
                {% if product.base_image %}
                <img loading="lazy" class="h-auto" src="{{ product.base_image.url }}" width="700" height="700" alt="{{ product.name }}">
                {% else %}
                <div class="no-image-placeholder">No image available</div>
                {% endif %}
              </div>
              {% for image in gallery_images %}
                    {% if not image.image_path|is_duplicate:product.base_image.url %}
              <div class="product-single__image-item">
                 
                <img loading="lazy" class="h-auto" src="{{ image.image_path.url }}" width="700" height="700" alt="{{ product.name }} - view {{ forloop.counter }}">
                
              </div>
              {% endif %}
                        {% endfor %}
            </div>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="sticky-content">
            <div class="mb-md-1 pb-md-3"></div>
            <div class="d-flex justify-content-between mb-4 pb-md-2">
              <div class="breadcrumb mb-0 d-none d-md-block flex-grow-1">
                <a href="{% url 'homepage' %}" class="menu-link menu-link_us-s text-uppercase fw-medium">Home</a>
                <span class="breadcrumb-separator menu-link fw-medium ps-1 pe-1">/</span>
                <a href="{% url 'shop' %}" class="menu-link menu-link_us-s text-uppercase fw-medium">The Shop</a>
                <span class="breadcrumb-separator menu-link fw-medium ps-1 pe-1">/</span>
                <a href="{% url 'shop' %}?brand={{ product.brand_id.id }}" class="menu-link menu-link_us-s text-uppercase fw-medium">{{ product.brand_id.name }}</a>
              </div><!-- /.breadcrumb -->  

              <!-- Replace the existing prev/next links with this code -->
<div class="product-single__prev-next d-flex align-items-center justify-content-between justify-content-md-end flex-grow-1">
    {% if prev_product %}
    <a href="{% url 'product_detail' prev_product.id %}" class="text-uppercase fw-medium">
        <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg">
            <use href="#icon_prev_md" />
        </svg>
        <span class="menu-link menu-link_us-s">Prev</span>
    </a>
    {% else %}
    <span class="text-uppercase fw-medium text-muted">
        <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg">
            <use href="#icon_prev_md" />
        </svg>
        <span class="menu-link menu-link_us-s">Prev</span>
    </span>
    {% endif %}
    
    {% if next_product %}
    <a href="{% url 'product_detail' next_product.id %}" class="text-uppercase fw-medium">
        <span class="menu-link menu-link_us-s">Next</span>
        <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg">
            <use href="#icon_next_md" />
        </svg>
    </a>
    {% else %}
    <span class="text-uppercase fw-medium text-muted">
        <span class="menu-link menu-link_us-s">Next</span>
        <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg">
            <use href="#icon_next_md" />
        </svg>
    </span>
    {% endif %}
</div><!-- /.shop-acs -->

            </div>
            <h1 class="product-single__name">{{ product.name }}</h1>
            <div class="product-single__rating">
              <div class="reviews-group d-flex">
                <svg class="review-star" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
                <svg class="review-star" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
                <svg class="review-star" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
                <svg class="review-star" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
                <svg class="review-star" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
              </div>
              <span class="reviews-note text-lowercase text-secondary ms-1">8k+ reviews</span>
            </div>
            <div class="product-single__price">
              <span class="current-price">â‚¹{{ product.price }}</span>
            </div>
            <div class="product-single__short-desc">
              <p>{{ product.description|truncatechars:78}}</p>
            </div>
            <form name="addtocart-form" method="post" action="{% url 'add_to_cart' product.id %}" id="add-to-cart-form">
    {% csrf_token %}
    <input type="hidden" name="product_id" value="{{ product.id }}">
    <input type="hidden" name="variant_id" id="selected-variant" value="" required>
    <input type="hidden" name="keep_cart_open" value="1">
    <div class="product-single__swatches">
    <div class="product-swatch text-swatches">
    <label>Sizes</label>
    <div class="swatch-list">
        {% for variant in variants %}
        <input type="radio" name="size" id="swatch-{{ forloop.counter }}">
        <label class="swatch js-swatch {% if variant.stock_quantity <= 0 %}disabled{% endif %}"
               data-variant-id="{{ variant.id }}"
               data-price="{{ product.price|add:variant.additional_price }}" 
               data-sku="{{ variant.sku }}"                                        
               data-stock="{{ variant.stock_quantity }}"
               for="swatch-{{ forloop.counter }}" 
               aria-label="Size {{ variant.size_id.name }}{% if variant.stock_quantity <= 0 %} - out of stock{% endif %}" 
               data-bs-toggle="tooltip" 
               data-bs-placement="top" 
               title="{{ variant.size_id.name }}">
            {{ variant.size_id.name }}{% if variant.stock_quantity <= 0 %}<span class="size-out">(X)</span>{% endif %}
        </label>
        {% endfor %}
    </div>
    <a href="#" class="sizeguide-link" data-bs-toggle="modal" data-bs-target="#sizeGuide">Size Guide</a>
</div>
                <div class="product-swatch color-swatches">
                  <label>Color</label>
                  <div class="swatch-list">
                   <h6 class="mb-1">{{ product.color }}</h6>
                  </div>
                </div>
              </div>
               <div class="product-single__addtocart">
         <div class="qty-control position-relative">
    <input type="number" name="quantity" value="1" min="1" 
           class="qty-control__number text-center">
    <div class="qty-control__reduce">-</div>
    <div class="qty-control__increase">+</div>
</div>
        <button type="submit" class="btn btn-primary btn-addtocart" {% if not in_stock %}disabled{% endif %}>
        {% if in_stock %}Add to Cart{% else %}Out of Stock{% endif %}
    </button>
    </div>
</form>
            <div class="product-single__addtolinks">
              <a href="{% url 'add_to_wishlist' product.id %}" class="menu-link menu-link_us-s add-to-wishlist" aria-label="{% if in_wishlist %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}">
    <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <use href="#icon_heart" {% if in_wishlist %}fill="black"{% endif %}/>
    </svg>
    <span>{% if in_wishlist %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}</span>
</a>
              <share-button class="share-button">
                <button class="menu-link menu-link_us-s to-share border-0 bg-transparent d-flex align-items-center">
                  <svg width="16" height="19" viewBox="0 0 16 19" fill="none" xmlns="http://www.w3.org/2000/svg"><use href="#icon_sharing" /></svg>
                  <span>Share</span>
                </button>
                <details id="Details-share-template__main" class="m-1 xl:m-1.5" hidden="">
                  <summary class="btn-solid m-1 xl:m-1.5 pt-3.5 pb-3 px-5">+</summary>
                  <div id="Article-share-template__main" class="share-button__fallback flex items-center absolute top-full left-0 w-full px-2 py-4 bg-container shadow-theme border-t z-10">
                    <div class="field grow mr-4">
                      <label class="field__label sr-only" for="url">Link</label>
                      <input type="text" class="field__input w-full" id="url" value="https://uomo-crystal.myshopify.com/blogs/news/go-to-wellness-tips-for-mental-health" placeholder="Link" onclick="this.select();" readonly="">
                    </div>
                    <button class="share-button__copy no-js-hidden">
                      <svg class="icon icon-clipboard inline-block mr-1" width="11" height="13" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewBox="0 0 11 13">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M2 1a1 1 0 011-1h7a1 1 0 011 1v9a1 1 0 01-1 1V1H2zM1 2a1 1 0 00-1 1v9a1 1 0 001 1h7a1 1 0 001-1V3a1 1 0 00-1-1H1zm0 10V3h7v9H1z" fill="currentColor"></path>
                      </svg>
                      <span class="sr-only">Copy link</span>
                    </button>
                  </div>
                </details>
              </share-button>
              <script src="{% static 'user/assets/js/details-disclosure.js' %}" defer></script>
              <script src="{% static 'user/assets/js/share.js' %}" defer></script>
            </div>
            <div class="product-single__meta-info">
              <div class="meta-item">
                <label>SKU:</label>
                <span class="sku-display">{{ variants.first.sku }}</span>
              </div>
              <div class="meta-item">
                <label>Categories:</label>
                <span><a href="{% url 'shop' %}?subcategory={{ product.subcategory_id.id }}">
                                    {{ product.subcategory_id.name }}
                                </a>
                            </span></span>
              </div>
              <div class="meta-item">
                <label>Tags:</label>
                <span>{% for tag in tags %}
                                <a href="{% url 'shop' %}?tag={{ tag.id }}" class="text-decoration-underline">
                                    {{ tag.tag }}{% if not forloop.last %}, {% endif %}
                                </a>
                                {% endfor %}</span>
              </div>
            </div>
            <div id="product_single_details_accordion" class="product-single__details-accordion accordion">
  <div class="accordion-item">
    <h5 class="accordion-header" id="accordion-heading-11">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-collapse-1" aria-expanded="false" aria-controls="accordion-collapse-1">
        Description
        <svg class="accordion-button__icon" viewBox="0 0 14 14"><g aria-hidden="true" stroke="none" fill-rule="evenodd"><path class="svg-path-vertical" d="M14,6 L14,8 L0,8 L0,6 L14,6"></path><path class="svg-path-horizontal" d="M14,6 L14,8 L0,8 L0,6 L14,6"></path></g></svg>
      </button>
    </h5>
    <div id="accordion-collapse-1" class="accordion-collapse collapse" aria-labelledby="accordion-heading-11" data-bs-parent="#product_single_details_accordion">
      <div class="accordion-body">
        <div class="product-single__description">
          <h3 class="block-title mb-4">{{ product.description|truncatechars:45 }}</h3>
          <p class="content">{{ product.description|linebreaks }}</p>    
        </div>
      </div>
    </div>
  </div><!-- /.accordion-item -->

              <div class="accordion-item">
                <h5 class="accordion-header" id="accordion-heading-2">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-collapse-2" aria-expanded="false" aria-controls="accordion-collapse-2">
                    Additional Information
                    <svg class="accordion-button__icon" viewBox="0 0 14 14"><g aria-hidden="true" stroke="none" fill-rule="evenodd"><path class="svg-path-vertical" d="M14,6 L14,8 L0,8 L0,6 L14,6"></path><path class="svg-path-horizontal" d="M14,6 L14,8 L0,8 L0,6 L14,6"></path></g></svg>
                  </button>
                </h5>
                <div id="accordion-collapse-2" class="accordion-collapse collapse" aria-labelledby="accordion-heading-2" data-bs-parent="#product_single_details_accordion">
                  <div class="accordion-body">
                    <div class="product-single__addtional-info">
                      <div class="item">
                        <label class="h6">Weight</label>
                        <span>{{product.weight}} kg</span>
                      </div>
                      <div class="item">
                        <label class="h6">Dimensions</label>
                        <span>{{product.dimensions}}</span>
                      </div>
                      <div class="item">
                        <label class="h6">Size</label>
                        <span>{% for variant in variants %}
                                {{ variant.size_id.name }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}</span>
                      </div>
                      <div class="item">
                        <label class="h6">Material</label>
                        <span>{{ product.material_id.name }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div><!-- /.accordion-item -->

              <div class="accordion-item">
  <h5 class="accordion-header" id="accordion-heading-3">
    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-collapse-3" aria-expanded="false" aria-controls="accordion-collapse-3">
      Reviews ({{ reviews.count }})
      <svg class="accordion-button__icon" viewBox="0 0 14 14"><g aria-hidden="true" stroke="none" fill-rule="evenodd"><path class="svg-path-vertical" d="M14,6 L14,8 L0,8 L0,6 L14,6"></path><path class="svg-path-horizontal" d="M14,6 L14,8 L0,8 L0,6 L14,6"></path></g></svg>
    </button>
  </h5>
  <div id="accordion-collapse-3" class="accordion-collapse collapse" aria-labelledby="accordion-heading-3" data-bs-parent="#product_single_details_accordion">
    <div class="accordion-body">
      <h2 class="product-single__reviews-title mb-4">Customer Reviews</h2>
      
      <!-- Review Stats -->
      <div class="review-stats mb-4 p-3 bg-light rounded">
        <div class="row align-items-center">
          <div class="col-md-6">
            <div class="d-flex align-items-center">
              <div class="display-4 fw-bold text-primary me-3">{{ average_rating|floatformat:1 }}</div>
              <div>
                <div class="reviews-group d-flex mb-1">
                  {% for i in "12345" %}
                    {% if forloop.counter <= average_rating %}
                      <svg class="review-star filled" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
                    {% else %}
                      <svg class="review-star" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
                    {% endif %}
                  {% endfor %}
                </div>
                <div class="text-muted small">Based on {{ reviews.count }} reviews</div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="rating-bars">
              {% for rating_value in "54321" %}
                {% with rating=rating_value|add:"0" %}
                {% with count=rating_counts|get_item:rating %}
                <div class="rating-bar-item d-flex align-items-center mb-2">
                  <div class="rating-number me-2">{{ rating }}</div>
                  <svg class="review-star me-2" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
                  <div class="progress flex-grow-1 me-2" style="height: 8px;">
                    <div class="progress-bar" role="progressbar" 
                         style="width: {% widthratio count reviews.count 100 %}%;" 
                         aria-valuenow="{% widthratio count reviews.count 100 %}" 
                         aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                  <div class="rating-count small text-muted" style="min-width: 30px;">{{ count }}</div>
                </div>
                {% endwith %}
                {% endwith %}
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <!-- Reviews List -->
      <div class="product-single__reviews-list">
        {% for review in reviews %}
        <div class="product-single__reviews-item mb-4 pb-4 border-bottom">
          <div class="d-flex">
            <div class="customer-avatar me-3">
              <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; font-size: 1.2rem;">
                {{ review.user_id.first_name|first|upper }}{{ review.user_id.last_name|first|upper }}
              </div>
            </div>
            <div class="customer-review flex-grow-1">
              <div class="customer-name d-flex justify-content-between align-items-start mb-2">
                <div>
                  <h6 class="mb-1">{{ review.user_id.first_name }} {{ review.user_id.last_name }}</h6>
                  <div class="reviews-group d-flex">
                    {% for i in "12345" %}
                      {% if forloop.counter <= review.rating %}
                        <svg class="review-star filled" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
                      {% else %}
                        <svg class="review-star" viewBox="0 0 9 9" xmlns="http://www.w3.org/2000/svg"><use href="#icon_star" /></svg>
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
                <div class="review-date text-muted small">{{ review.created_at|date:"F d, Y" }}</div>
              </div>
              {% if review.title %}
              <h6 class="review-title fw-semibold mb-2">{{ review.title }}</h6>
              {% endif %}
              <div class="review-text">
                <p class="mb-0">{{ review.comment }}</p>
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="text-center py-4">
          <div class="mb-3">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="#6c757d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <h5 class="text-muted">No reviews yet</h5>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div><!-- /.accordion-item -->

<style>
.review-star {
  width: 16px;
  height: 16px;
  fill: #ddd;
}

.review-star.filled {
  fill: #ffc107;
}

.progress-bar {
  background-color: #ffc107;
}

.rating-bar-item {
  font-size: 0.9rem;
}
</style>
            </div>
            <div class="product-single__additional-info">
              <a href="#" data-bs-toggle="modal" data-bs-target="#compositionModal">Composition and Care</a>
              <a href="#" data-bs-toggle="modal" data-bs-target="#deliveryModal">Delivery and Return</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    {% if recently_viewed_products %}
    <section class="products-carousel container">
      <h2 class="section-title text-uppercase text-center mb-4 pb-xl-2 mb-xl-4">Recently Viewed</h2>

      <div id="product_carousel" class="position-relative">
        <div class="swiper-container js-swiper-slider"
          data-settings='{
            "autoplay": {
              "delay": 5000
            },
            "slidesPerView": 4,
            "slidesPerGroup": 4,
            "effect": "none",
            "loop": true,
            "pagination": {
              "el": "#product_carousel .products-pagination",
              "type": "bullets",
              "clickable": true
            },
            "navigation": {
              "nextEl": "#product_carousel .products-carousel__next",
              "prevEl": "#product_carousel .products-carousel__prev"
            },
            "breakpoints": {
              "320": {
                "slidesPerView": 2,
                "slidesPerGroup": 2,
                "spaceBetween": 14
              },
              "768": {
                "slidesPerView": 3,
                "slidesPerGroup": 3,
                "spaceBetween": 24
              },
              "992": {
                "slidesPerView": 4,
                "slidesPerGroup": 1,
                "spaceBetween": 30
              }
            }
          }'>
          <div class="swiper-wrapper">
             {% for product in recently_viewed_products %}
            <div class="swiper-slide product-card">
              <div class="pc__img-wrapper">
                <a href="{% url 'product_detail' product.id %}">
                  <img loading="lazy" src="{{ product.base_image.url }}" alt="{{ product.name }}" class="pc__img">
                </a>
            <button class="pc__atc btn anim_appear-bottom btn position-absolute border-0 text-uppercase fw-medium js-add-cart js-open-aside" data-aside="cartDrawer" title="Add To Cart">Add To Cart</button>
          </div>

          <div class="pc__info position-relative">
            <p class="pc__category">{{ product.brand_id.name }}</p>
            <h6 class="pc__title"><a href="{% url 'product_detail' product.id %}">{{ product.name|truncatechars:39 }}</a></h6>
            <div class="product-card__price d-flex">
              <span class="money price">â‚¹{{ product.price }}</span>
            </div>

            <button class="pc__btn-wl position-absolute top-0 end-0 bg-transparent border-0 js-add-wishlist" title="Add To Wishlist">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><use href="#icon_heart" /></svg>
            </button>
          </div>
        </div>
        {% endfor %}

      </div><!-- /.swiper-wrapper -->
    </div><!-- /.swiper-container js-swiper-slider -->

    <div class="products-carousel__prev position-absolute top-50 d-flex align-items-center justify-content-center">
      <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><use href="#icon_prev_md" /></svg>
    </div><!-- /.products-carousel__prev -->
    <div class="products-carousel__next position-absolute top-50 d-flex align-items-center justify-content-center">
      <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><use href="#icon_next_md" /></svg>
    </div><!-- /.products-carousel__next -->

    <div class="products-pagination mt-4 mb-5 d-flex align-items-center justify-content-center"></div>
    <!-- /.products-pagination -->
  </div><!-- /.position-relative -->

</section>
{% endif %}

{% if fbt_products %}
<section class="fbt-section container mb-5">
    <div class="fbt-header text-center mb-5">
        <h2 class="section-title text-uppercase mb-3">Complete Your Look</h2>
        <p class="text-muted mb-4">Customers who bought this item also purchased</p>
    </div>

    <div class="fbt-container">
        <div class="row g-4 align-items-center justify-content-center">
            <!-- Main Product -->
            <div class="col-lg-3 col-md-4">
                <div class="fbt-product-card featured">
                    <div class="product-badge">Your Choice</div>
                    <div class="product-image">
                        <img src="{{ product.base_image.url }}" alt="{{ product.name }}" class="img-fluid">
                    </div>
                    <div class="product-info text-center mt-3">
                        <h6 class="product-name mb-2">{{ product.name|truncatechars:35 }}</h6>
                        <div class="product-price">
                            <span class="current-price" data-price="{{ product.price }}">â‚¹{{ product.price }}</span>
                        </div>
                        <div class="product-selection mt-2">
                            <span class="selected-badge">Selected</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plus Icon -->
            <div class="col-lg-auto col-md-1 d-none d-md-block">
                <div class="fbt-connector">
                    <div class="plus-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="connector-line"></div>
                </div>
            </div>

            <!-- FBT Products -->
            <div class="col-lg-8 col-md-7">
                <div class="row g-3">
                    {% for fbt_product in fbt_products %}
                    <div class="col-xl-4 col-md-6">
                        <div class="fbt-product-card selectable" data-product-id="{{ fbt_product.id }}">
                            <div class="product-checkbox">
                                <input type="checkbox" id="fbt-{{ fbt_product.id }}" checked>
                                <label for="fbt-{{ fbt_product.id }}"></label>
                            </div>
                            <div class="product-image">
                                <img src="{{ fbt_product.base_image.url }}" alt="{{ fbt_product.name }}" class="img-fluid">
                                <a href="{% url 'product_detail' fbt_product.id %}" class="product-quick-view">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1 8C1 8 3.5 3 8 3C12.5 3 15 8 15 8C15 8 12.5 13 8 13C3.5 13 1 8 1 8Z" stroke="currentColor" stroke-width="1.5"/>
                                        <circle cx="8" cy="8" r="2" stroke="currentColor" stroke-width="1.5"/>
                                    </svg>
                                </a>
                            </div>
                            <div class="product-info">
                                <h6 class="product-name">{{ fbt_product.name|truncatechars:30 }}</h6>
                                <p class="product-brand text-muted small mb-2">{{ fbt_product.brand_id.name }}</p>
                                <div class="product-price">
                                    <span class="current-price" data-price="{{ fbt_product.price }}">â‚¹{{ fbt_product.price }}</span>
                                </div>
                                <div class="product-actions mt-2">
                                    <button class="btn-quantity btn-minus">-</button>
                                    <input type="number" class="quantity-input" value="1" min="1" max="10" data-product-id="{{ fbt_product.id }}">
                                    <button class="btn-quantity btn-plus">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Bundle Summary -->
        <div class="fbt-summary mt-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="summary-card bg-light rounded-3 p-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="bundle-details">
                                    <h5 class="mb-3">Order Summary</h5>
                                    <div class="price-breakdown">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Selected Items:</span>
                                            <span><span class="selected-count">1</span> items</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Total Quantity:</span>
                                            <span><span class="total-quantity">1</span> pcs</span>
                                        </div>
                                        <div class="d-flex justify-content-between fw-bold fs-5 mt-3 pt-2 border-top">
                                            <span>Total Amount:</span>
                                            <span class="text-primary">â‚¹<span class="bundle-total">{{ product.price }}</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 text-center text-md-end">
                                <div class="bundle-actions">
                                    <button class="btn btn-primary btn-lg me-3 add-bundle-to-cart">
                                        <i class="bi bi-cart-plus me-2"></i>
                                        Add All to Cart
                                    </button>
                                    <button class="btn btn-outline-secondary add-selected-to-cart">
                                        Add Selected to Cart
                                    </button>
                                    <p class="text-muted small mt-2">
                                        <i class="bi bi-truck me-1"></i>
                                        Free shipping on orders above â‚¹999
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endif %}

{% if related_products %}
    <section class="products-carousel container">
      <h2 class="section-title text-uppercase text-center mb-4 pb-xl-2 mb-xl-4">Related Products</h2>

      <div id="product_carousel" class="position-relative">
        <div class="swiper-container js-swiper-slider"
          data-settings='{
            "autoplay": {
              "delay": 5000
            },
            "slidesPerView": 4,
            "slidesPerGroup": 4,
            "effect": "none",
            "loop": true,
            "pagination": {
              "el": "#product_carousel .products-pagination",
              "type": "bullets",
              "clickable": true
            },
            "navigation": {
              "nextEl": "#product_carousel .products-carousel__next",
              "prevEl": "#product_carousel .products-carousel__prev"
            },
            "breakpoints": {
              "320": {
                "slidesPerView": 2,
                "slidesPerGroup": 2,
                "spaceBetween": 14
              },
              "768": {
                "slidesPerView": 3,
                "slidesPerGroup": 3,
                "spaceBetween": 24
              },
              "992": {
                "slidesPerView": 4,
                "slidesPerGroup": 1,
                "spaceBetween": 30
              }
            }
          }'>
            
      <div class="swiper-wrapper">
         {% for related_product in related_products %}
        <div class="swiper-slide product-card">
          <div class="pc__img-wrapper" >
            <a href="{% url 'product_detail' related_product.id %}">
              <img loading="lazy" src="{{ related_product.base_image.url }}" alt="{{ related_product.name }}" class="pc__img">
            </a>
            <button class="pc__atc btn anim_appear-bottom btn position-absolute border-0 text-uppercase fw-medium js-add-cart js-open-aside" data-aside="cartDrawer" title="Add To Cart">Add To Cart</button>
          </div>

          <div class="pc__info position-relative">
            <p class="pc__category">{{ related_product.brand_id.name }}</p>
            <h6 class="pc__title"><a href="{% url 'product_detail' related_product.id %}">{{ related_product.name|truncatechars:39 }}</a></h6>
            <div class="product-card__price d-flex">
              <span class="money price">â‚¹{{ related_product.price }}</span>
            </div>

            <button class="pc__btn-wl position-absolute top-0 end-0 bg-transparent border-0 js-add-wishlist" title="Add To Wishlist">
              <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><use href="#icon_heart" /></svg>
            </button>
          </div>
        </div>
        {% endfor %}
        
      </div><!-- /.swiper-wrapper -->
    </div><!-- /.swiper-container js-swiper-slider -->

    <div class="products-carousel__prev position-absolute top-50 d-flex align-items-center justify-content-center">
      <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><use href="#icon_prev_md" /></svg>
    </div><!-- /.products-carousel__prev -->
    <div class="products-carousel__next position-absolute top-50 d-flex align-items-center justify-content-center">
      <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg"><use href="#icon_next_md" /></svg>
    </div><!-- /.products-carousel__next -->

    <div class="products-pagination mt-4 mb-5 d-flex align-items-center justify-content-center"></div>
    <!-- /.products-pagination -->
  </div><!-- /.position-relative -->

</section><!-- /.products-carousel container -->
{% endif %}
</main>

  <div class="mb-5 pb-xl-5"></div>
  
  <!-- Footer Type 1 -->
  
  <!-- Go To Top -->
  <div id="scrollTop" class="visually-hidden end-0"></div>

  <!-- Sizeguide -->
<!-- Simple Size Guide -->
<div class="modal fade" id="sizeGuide" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog size-guide">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Size Guide</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <!-- Women's Size Chart -->
        <h6 class="mb-3">Women's Clothing</h6>
        <div class="table-responsive">
          <table class="table table-bordered table-sm text-center">
            <thead class="table-light">
              <tr>
                <th>Size</th>
                <th>XS</th>
                <th>S</th>
                <th>M</th>
                <th>L</th>
                <th>XL</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-start">Bust (inches)</td>
                <td>32</td>
                <td>34</td>
                <td>36</td>
                <td>38</td>
                <td>40</td>
              </tr>
              <tr>
                <td class="text-start">Waist (inches)</td>
                <td>26</td>
                <td>28</td>
                <td>30</td>
                <td>32</td>
                <td>34</td>
              </tr>
              <tr>
                <td class="text-start">Hip (inches)</td>
                <td>36</td>
                <td>38</td>
                <td>40</td>
                <td>42</td>
                <td>44</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Men's Size Chart -->
        <h6 class="mb-3 mt-4">Men's Clothing</h6>
        <div class="table-responsive">
          <table class="table table-bordered table-sm text-center">
            <thead class="table-light">
              <tr>
                <th>Size</th>
                <th>S</th>
                <th>M</th>
                <th>L</th>
                <th>XL</th>
                <th>XXL</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-start">Chest (inches)</td>
                <td>36</td>
                <td>38</td>
                <td>40</td>
                <td>42</td>
                <td>44</td>
              </tr>
              <tr>
                <td class="text-start">Waist (inches)</td>
                <td>30</td>
                <td>32</td>
                <td>34</td>
                <td>36</td>
                <td>38</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- How to Measure -->
        <div class="mt-4 p-3 bg-light rounded">
          <h6 class="mb-2">How to Measure:</h6>
          <ul class="mb-0 small ps-3">
            <li><strong>Bust/Chest:</strong> Measure around the fullest part</li>
            <li><strong>Waist:</strong> Measure around your natural waistline</li>
            <li><strong>Hips:</strong> Measure around the widest part</li>
          </ul>
        </div>

        <!-- Size Tip -->
        <div class="alert alert-warning mt-3 py-2 small">
          <strong>Note:</strong> Indian sizes may vary slightly between brands.
        </div>

      </div>
    </div>
  </div>
</div>
  

<!-- Delivery Modal -->
<div class="modal fade" id="deliveryModal" tabindex="-1" aria-labelledby="deliveryModal" aria-hidden="true">
  <div class="modal-dialog delivery-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delivery & Returns</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="delivery-modal__wrapper">
          
          <!-- Express Delivery -->
          <div class="delivery-option mb-4">
            <div class="d-flex align-items-center justify-content-between">
              <h6 class="mb-1">Express Delivery</h6>
              <span class="text-primary fw-bold">â‚¹149</span>
            </div>
            <p class="mb-0">Get your order delivered within 1-2 business days</p>
            <small class="text-muted">Order before 4 PM for next day delivery</small>
          </div>

          <!-- Standard Delivery -->
          <div class="delivery-option mb-4">
            <div class="d-flex align-items-center justify-content-between">
              <h6 class="mb-1">Standard Delivery</h6>
              <span class="text-primary fw-bold">â‚¹69</span>
            </div>
            <p class="mb-0">Delivery within 3-5 business days</p>
            <small class="text-muted">Free delivery on orders above â‚¹999</small>
          </div>

          <!-- Free Delivery -->
          <div class="delivery-option mb-4">
            <div class="d-flex align-items-center justify-content-between">
              <h6 class="mb-1">Free Delivery</h6>
              <span class="text-success fw-bold">FREE</span>
            </div>
            <p class="mb-0">On all orders above â‚¹999</p>
            <small class="text-muted">Delivery within 5-7 business days</small>
          </div>

          <!-- Easy Returns -->
          <div class="returns-policy p-3 bg-light rounded">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <h6 class="mb-0">Easy Returns</h6>
              <span class="badge bg-success">7 Days</span>
            </div>
            <p class="mb-1">Easy 7-day return policy</p>
            <small class="text-muted">
              â€¢ Return within 7 days of delivery<br>
              â€¢ Items must be unused with original tags<br>
              â€¢ Free pickup for returns
            </small>
          </div>

        </div>
      </div>
    </div>
  </div><!-- /.modal-dialog -->
</div><!-- /.delivery-modal -->

<!-- Composition & Care Modal -->
<div class="modal fade" id="compositionModal" tabindex="-1" aria-labelledby="compositionModal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-light">
        <h5 class="modal-title fw-bold text-dark"><i class="bi bi-info-circle me-2"></i>Composition & Care Guide</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="composition-care-wrapper">
          
          <!-- Fabric Composition -->
          <div class="composition-section mb-4">
            <div class="d-flex align-items-center mb-3">
              <div class="bg-primary p-2 rounded-circle me-3">
                <i class="bi bi-grid-3x3 text-white fs-5"></i>
              </div>
              <h6 class="mb-0 fw-semibold">Fabric Composition</h6>
            </div>
            <div class="card border-0 shadow-sm">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-md-6">
                    <div class="d-flex justify-content-between align-items-center py-2">
                      <span class="text-muted">Main Fabric</span>
                      <span class="fw-medium text-dark">100% Cotton</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center py-2 border-top">
                      <span class="text-muted">Lining</span>
                      <span class="fw-medium text-dark">100% Polyester</span>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="d-flex justify-content-between align-items-center py-2">
                      <span class="text-muted">Thread</span>
                      <span class="fw-medium text-dark">Polyester</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center py-2 border-top">
                      <span class="text-muted">Embellishments</span>
                      <span class="fw-medium text-dark">None</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Care Instructions -->
          <div class="care-section">
            <div class="d-flex align-items-center mb-3">
              <div class="bg-success p-2 rounded-circle me-3">
                <i class="bi bi-heart text-white fs-5"></i>
              </div>
              <h6 class="mb-0 fw-semibold">Care Instructions</h6>
            </div>
            
            <div class="row g-3">
              <!-- Washing -->
              <div class="col-md-6">
                <div class="card h-100 border-0 shadow-sm">
                  <div class="card-body text-center p-3">
                    <div class="bg-info bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                      <i class="bi bi-droplet-fill text-info fs-5"></i>
                    </div>
                    <h6 class="card-title fw-semibold mb-2">Washing</h6>
                    <ul class="list-unstyled mb-0">
                      <li class="mb-1 d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2 small"></i>
                        <span class="small">Machine wash cold (30Â°C)</span>
                      </li>
                      <li class="mb-1 d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2 small"></i>
                        <span class="small">Gentle cycle</span>
                      </li>
                      <li class="mb-1 d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2 small"></i>
                        <span class="small">Use mild detergent</span>
                      </li>
                      <li class="d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2 small"></i>
                        <span class="small">Wash with similar colors</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Drying & Ironing -->
              <div class="col-md-6">
                <div class="card h-100 border-0 shadow-sm">
                  <div class="card-body text-center p-3">
                    <div class="bg-warning bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                      <i class="bi bi-sun-fill text-warning fs-5"></i>
                    </div>
                    <h6 class="card-title fw-semibold mb-2">Drying & Ironing</h6>
                    <ul class="list-unstyled mb-0">
                      <li class="mb-1 d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2 small"></i>
                        <span class="small">Tumble dry low heat</span>
                      </li>
                      <li class="mb-1 d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2 small"></i>
                        <span class="small">Line dry in shade</span>
                      </li>
                      <li class="mb-1 d-flex align-items-center">
                        <i class="bi bi-check-circle-fill text-success me-2 small"></i>
                        <span class="small">Iron on medium heat</span>
                      </li>
                      <li class="d-flex align-items-center">
                        <i class="bi bi-x-circle-fill text-danger me-2 small"></i>
                        <span class="small">Do not bleach</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Tips -->
          <div class="tips-section mt-4">
            <div class="card border-0 bg-light">
              <div class="card-body p-3">
                <div class="d-flex align-items-center mb-2">
                  <i class="bi bi-lightbulb-fill text-warning me-2"></i>
                  <h6 class="mb-0 fw-semibold small">Pro Care Tips</h6>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <ul class="mb-0 small">
                      <li class="mb-1">Turn garment inside out before washing</li>
                      <li class="mb-0">Do not wring or twist the fabric</li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <ul class="mb-0 small">
                      <li class="mb-1">Store in dry place away from direct sunlight</li>
                      <li class="mb-0">For stains, treat immediately with mild solution</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
      <div class="modal-footer bg-light">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block script %}
<!-- External JavaScripts -->
<script src="{% static 'user/assets/js/plugins/jquery.min.js' %}"></script>
<script src="{% static 'user/assets/js/plugins/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'user/assets/js/plugins/bootstrap-slider.min.js' %}"></script>
<script src="{% static 'user/assets/js/plugins/swiper.min.js' %}"></script>
<script src="{% static 'user/assets/js/plugins/countdown.js' %}"></script>
<script src="{% static 'user/assets/js/plugins/jquery.fancybox.js' %}"></script>

<!-- Footer Scripts -->
<script src="{% static 'user/assets/js/theme.js' %}"></script>

<script>
$(document).ready(function() {
    // Initialize tooltips
    $('[data-bs-toggle="tooltip"]').tooltip();
    
    // Auto-select the first available size on page load
    function autoSelectFirstSize() {
        // Wait a bit to ensure all elements are rendered
        setTimeout(function() {
            const firstAvailableSize = $('.js-swatch:not(.disabled)').first();
            console.log('Found available sizes:', $('.js-swatch:not(.disabled)').length);
            console.log('First available size:', firstAvailableSize);
            
            if (firstAvailableSize.length > 0) {
                // Remove active class from all swatches first
                $('.js-swatch').removeClass('active');
                
                // Add active class to first available swatch
                firstAvailableSize.addClass('active');
                
                // Trigger the selection logic
                const variantId = firstAvailableSize.data('variant-id');
                const price = firstAvailableSize.data('price');
                const sku = firstAvailableSize.data('sku');
                const stock = firstAvailableSize.data('stock');
                
                // Update hidden input with selected variant
                $('#selected-variant').val(variantId);
                
                // Update price display
                $('.product-single__price .current-price').text('â‚¹' + price);
                
                // Update SKU display
                $('.sku-display').text(sku);
                
                // Enable/disable add to cart button based on stock
                const addToCartBtn = $('.btn-addtocart');
                if (stock > 0) {
                    addToCartBtn.prop('disabled', false).text('Add to Cart');
                } else {
                    addToCartBtn.prop('disabled', true).text('Out of Stock');
                }
                
                console.log('Auto-selected size:', firstAvailableSize.text().trim(), 'with variant ID:', variantId);
            } else {
                console.log('No available sizes found');
                // If no sizes available, disable the add to cart button
                $('.btn-addtocart').prop('disabled', true).text('Out of Stock');
            }
        }, 100);
    }
    
    // Call the function to auto-select first size
    autoSelectFirstSize();
    
    // Size selection functionality
    $('.js-swatch').on('click', function(e) {
        e.preventDefault();
        
        // Skip if disabled (out of stock)
        if ($(this).hasClass('disabled')) {
            return;
        }
        
        // Remove active class from all swatches
        $('.js-swatch').removeClass('active');
        
        // Add active class to clicked swatch
        $(this).addClass('active');
        
        // Get variant data
        const variantId = $(this).data('variant-id');
        const price = $(this).data('price');
        const sku = $(this).data('sku');
        const stock = $(this).data('stock');
        
        // Update hidden input with selected variant
        $('#selected-variant').val(variantId);
        
        // Update price display
        $('.product-single__price .current-price').text('â‚¹' + price);
        
        // Update SKU display
        $('.sku-display').text(sku);
        
        // Reset quantity to 1 when changing size
        $('input[name="quantity"]').val(1);
        
        // Enable/disable add to cart button based on stock
        const addToCartBtn = $('.btn-addtocart');
        if (stock > 0) {
            addToCartBtn.prop('disabled', false).text('Add to Cart');
        } else {
            addToCartBtn.prop('disabled', true).text('Out of Stock');
        }
    });
    
    // Add to cart form submission
    $('#add-to-cart-form').on('submit', function(e) {
        e.preventDefault();
        
        // Check if a size is selected
        if (!$('#selected-variant').val()) {
            alert('Please select a size');
            return false;
        }
        
        // Validate quantity
        const quantity = parseInt($('input[name="quantity"]').val());
        if (isNaN(quantity) || quantity < 1) {
            alert('Please enter a valid quantity');
            return false;
        }
        
        // Validate quantity against stock
        const selectedVariant = $('.js-swatch.active');
        const maxStock = selectedVariant.data('stock');
        
        if (quantity > maxStock) {
            alert('Cannot add more than available stock (' + maxStock + ' items available)');
            return false;
        }
        
        // Submit the form via standard POST (no AJAX as requested)
        this.submit();
    });
    
    // Wishlist functionality
    $('.add-to-wishlist').on('click', function(e) {
        e.preventDefault();
        
        // Redirect to the wishlist URL (standard form submission)
        window.location.href = $(this).attr('href');
    });
    
    // Check if we need to open the cart drawer after page load
    // This handles the case where we're redirected back after adding to cart
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('show_cart') === '1') {
        // Open the cart drawer
        $('.js-open-aside[data-aside="cartDrawer"]').trigger('click');
        
        // Clean up the URL
        const cleanUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
        window.history.replaceState({}, document.title, cleanUrl);
    }
});
</script>
<script>
$(document).ready(function() {
    // Initialize cart items storage
    let cartItems = [];
    
    // Calculate initial bundle price
    calculateBundlePrice();
    
    // Quantity controls
    $('.btn-plus').on('click', function() {
        const input = $(this).siblings('.quantity-input');
        const currentVal = parseInt(input.val());
        if (currentVal < 10) {
            input.val(currentVal + 1);
            calculateBundlePrice();
        }
    });
    
    $('.btn-minus').on('click', function() {
        const input = $(this).siblings('.quantity-input');
        const currentVal = parseInt(input.val());
        if (currentVal > 1) {
            input.val(currentVal - 1);
            calculateBundlePrice();
        }
    });
    
    $('.quantity-input').on('change', function() {
        let value = parseInt($(this).val());
        if (isNaN(value) || value < 1) value = 1;
        if (value > 10) value = 10;
        $(this).val(value);
        calculateBundlePrice();
    });
    
    // Checkbox toggle
    $('.product-checkbox input[type="checkbox"]').on('change', function() {
        const card = $(this).closest('.fbt-product-card');
        if ($(this).is(':checked')) {
            card.addClass('selected');
            card.css('border-color', '#007bff');
        } else {
            card.removeClass('selected');
            card.css('border-color', 'transparent');
        }
        calculateBundlePrice();
    });
    
    // Calculate bundle price
    function calculateBundlePrice() {
        let subtotal = parseFloat('{{ product.price }}');
        let selectedCount = 1; // Main product is always selected
        let totalQuantity = 1; // Main product quantity
        
        // Calculate FBT products
        $('.fbt-product-card.selectable').each(function() {
            const checkbox = $(this).find('input[type="checkbox"]');
            if (checkbox.is(':checked')) {
                const priceText = $(this).find('.current-price').data('price');
                const price = parseFloat(priceText);
                const quantity = parseInt($(this).find('.quantity-input').val());
                subtotal += price * quantity;
                selectedCount++;
                totalQuantity += quantity;
            }
        });
        
        // Update display
        $('.selected-count').text(selectedCount);
        $('.total-quantity').text(totalQuantity);
        $('.bundle-total').text(subtotal.toFixed(2));
    }
    
    // Add all products to cart
    $('.add-bundle-to-cart').on('click', function() {
        cartItems = []; // Reset cart
        
        // Add main product
        cartItems.push({
            id: '{{ product.id }}',
            name: '{{ product.name }}',
            price: parseFloat('{{ product.price }}'),
            quantity: 1,
            image: '{{ product.base_image.url }}'
        });
        
        // Add all FBT products
        $('.fbt-product-card.selectable').each(function() {
            const productId = $(this).data('product-id');
            const productName = $(this).find('.product-name').text();
            const price = parseFloat($(this).find('.current-price').data('price'));
            const quantity = parseInt($(this).find('.quantity-input').val());
            const image = $(this).find('img').attr('src');
            
            cartItems.push({
                id: productId,
                name: productName,
                price: price,
                quantity: quantity,
                image: image
            });
        });
        
        addToCart(cartItems, 'All items added to cart successfully!');
    });
    
    // Add only selected products to cart
    $('.add-selected-to-cart').on('click', function() {
        cartItems = []; // Reset cart
        
        // Add main product (always selected)
        cartItems.push({
            id: '{{ product.id }}',
            name: '{{ product.name }}',
            price: parseFloat('{{ product.price }}'),
            quantity: 1,
            image: '{{ product.base_image.url }}'
        });
        
        // Add selected FBT products
        $('.fbt-product-card.selectable').each(function() {
            const checkbox = $(this).find('input[type="checkbox"]');
            if (checkbox.is(':checked')) {
                const productId = $(this).data('product-id');
                const productName = $(this).find('.product-name').text();
                const price = parseFloat($(this).find('.current-price').data('price'));
                const quantity = parseInt($(this).find('.quantity-input').val());
                const image = $(this).find('img').attr('src');
                
                cartItems.push({
                    id: productId,
                    name: productName,
                    price: price,
                    quantity: quantity,
                    image: image
                });
            }
        });
        
        addToCart(cartItems, 'Selected items added to cart successfully!');
    });
    
    // Add items to cart function
    function addToCart(items, successMessage) {
        // Store in localStorage for demo purposes
        // In real implementation, this would be an API call
        const existingCart = JSON.parse(localStorage.getItem('fbtCart') || '[]');
        const updatedCart = [...existingCart, ...items];
        localStorage.setItem('fbtCart', JSON.stringify(updatedCart));
        
        // Show success message
        showToast(successMessage);
        
        // Update cart count in header (if exists)
        updateCartCount(updatedCart.length);
        
        // Open cart drawer
        setTimeout(() => {
            $('.js-open-aside[data-aside="cartDrawer"]').trigger('click');
        }, 1000);
    }
    
    // Show toast notification
    function showToast(message) {
        // Create toast element
        const toast = $(`
            <div class="position-fixed top-0 end-0 p-3" style="z-index: 9999">
                <div class="toast show" role="alert">
                    <div class="toast-header bg-success text-white">
                        <strong class="me-auto">Success</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            </div>
        `);
        
        $('body').append(toast);
        
        // Auto remove after 3 seconds
        setTimeout(() => {
            toast.remove();
        }, 3000);
    }
    
    // Update cart count in header
    function updateCartCount(count) {
        const cartBadge = $('.cart-count-badge, .header-cart-count');
        if (cartBadge.length) {
            cartBadge.text(count);
        }
    }
});
</script>
{% endblock %}