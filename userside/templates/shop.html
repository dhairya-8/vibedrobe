{% extends 'base1.html' %}
{% load product_filters %} 
{% load static %}

{% block title %}Shop Page | VibeDrobe{% endblock %}

{% block css %}
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{% static 'user/assets/css/plugins/swiper.min.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'user/assets/css/style.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'user/assets/css/shop.css' %}" type="text/css">
    <style>
/* In shop.html, inside the <style> block */

.search-results-title {
  font-size: 1.1rem; /* Slightly larger than normal text, but smaller than h3 */
  font-weight: 500;  /* A medium weight, not too bold */
  color: #6c757d;   /* Matches the secondary text color in your theme */
  letter-spacing: 0.5px; /* Adds a bit of refinement */
}

.search-results-title span {
  color: #212529; /* A standard dark color for the keyword itself */
  font-weight: 600; /* Makes the keyword slightly bolder */
}
        /* Fix for the "Clear" filter links */
.btn-link.text-danger {
    text-decoration: none !important; /* Disables the default underline */
}

/* Add a subtle bottom border for the desired "underline" look */
.btn-link.text-danger:hover {
    text-decoration: none;
    border-bottom: 1px solid #00000001; /* Adds a single line on hover */
}

        /* Resetting the default blue color and double underline for all pagination links */
.shop-pages a,
.shop-pages a:hover,
.shop-pages a:focus {
    color: initial; /* or your desired text color, e.g., #000 */
    text-decoration: none;
}

/* Styling for the active page link */
.shop-pages .btn-link_active {
    color: #fff; /* or the color you want for the active link text */
    background-color: #000; /* or your desired active link background color */
    border: 1px solid #000; /* or your desired border color */
    text-decoration: none; /* Ensure no underline on the active link */
}

/* Styling for the disabled "PREV" and "NEXT" spans */
.shop-pages .disabled {
    color: #ccc; /* or a lighter color to indicate it's disabled */
    pointer-events: none; /* Disable click events */
}
        .product-count-badge {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 0.85rem;
            font-weight: 500;
            color: #6c757d;
            display: inline-flex;
            align-items: center;
            margin-left: 10px;
        }
        
        .product-count-badge .count-number {
            color: #dc3545;
            font-weight: 600;
            margin: 0 4px;
        }
        
        .product-count-icon {
            margin-right: 6px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .product-count-badge {
                margin-left: 0;
                margin-top: 10px;
            }
        }
        
        /* Quick view modal specific styles */
        .quick-view .swatch {
            cursor: pointer;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 5px;
            margin-bottom: 5px;
            display: inline-block;
        }
        
        .quick-view .swatch.active {
            background-color: #000;
            color: white;
            border-color: #000;
        }
        
        .quick-view .swatch.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
{% endblock %}

{% block content %}
<main>
    <section class="shop-main container d-flex pt-4 pt-xl-5">
        
        <!-- SIDEBAR FILTERS -->
        <div class="shop-sidebar side-sticky bg-body" id="shopFilter">
            <div class="aside-header d-flex d-lg-none align-items-center">
                <h3 class="text-uppercase fs-6 mb-0">Filter By</h3>
                <button class="btn-close-lg js-close-aside btn-close-aside ms-auto"></button>
            </div>

            <div class="pt-4 pt-lg-0"></div>

            <!-- GENDER FILTER -->
            <div class="accordion" id="gender-filters">
                <div class="accordion-item mb-4 pb-3">
                    <h5 class="accordion-header" id="accordion-heading-gender">
                        <button class="accordion-button p-0 border-0 fs-5 text-uppercase" 
                                type="button" 
                                data-bs-toggle="collapse" 
                                data-bs-target="#accordion-filter-gender" 
                                aria-expanded="true" 
                                aria-controls="accordion-filter-gender">
                            Gender
                            <svg class="accordion-button__icon type2" viewBox="0 0 10 6" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5.35668 0.159286C5.16235 -0.053094 4.83769 -0.0530941 4.64287 0.159286L0.147611 5.05963C-0.0492049 5.27473 -0.049205 5.62357 0.147611 5.83813C0.344427 6.05323 0.664108 6.05323 0.860924 5.83813L5 1.32706L9.13858 5.83867C9.33589 6.05378 9.65507 6.05378 9.85239 5.83867C10.0492 5.62357 10.0492 5.27473 9.85239 5.06018L5.35668 0.159286Z"/>
                            </svg>
                        </button>
                    </h5>
                    
                    <div id="accordion-filter-gender" 
                         class="accordion-collapse collapse show border-0" 
                         aria-labelledby="accordion-heading-gender" 
                         data-bs-parent="#gender-filters">
                        <div class="accordion-body px-0 pb-0">
                            <ul class="list-unstyled mb-0">
                                <li class="mb-2">
                                    <a href="javascript:void(0)" 
                                       class="menu-link gender-link py-1 d-block {% if request.GET.gender == 'Female' %}fw-bold text-dark{% endif %}" 
                                       data-gender="Female">
                                        Women
                                        <span class="text-secondary ms-2">{{ women_count }}</span>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a href="javascript:void(0)" 
                                       class="menu-link gender-link py-1 d-block {% if request.GET.gender == 'Male' %}fw-bold text-dark{% endif %}" 
                                       data-gender="Male">
                                        Men
                                        <span class="text-secondary ms-2">{{ men_count }}</span>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a href="javascript:void(0)" 
                                       class="menu-link gender-link py-1 d-block {% if request.GET.gender == 'Unisex' %}fw-bold text-dark{% endif %}" 
                                       data-gender="Unisex">
                                        Unisex
                                        <span class="text-secondary ms-2">{{ unisex_count }}</span>
                                    </a>
                                </li>
                            </ul>
                            
                            {% if request.GET.gender %}
                                <div class="mt-3">
                                    <a href="javascript:void(0)" 
                                       class="btn btn-sm btn-link text-danger p-0 js-clear-gender">
                                        Clear Gender
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- CATEGORIES FILTER -->
            <div class="accordion" id="categories-list">
                <div class="accordion-item mb-4 pb-3">
                    <h5 class="accordion-header" id="accordion-heading-11">
                        <button class="accordion-button p-0 border-0 fs-5 text-uppercase" 
                                type="button" 
                                data-bs-toggle="collapse" 
                                data-bs-target="#accordion-filter-1" 
                                aria-expanded="true" 
                                aria-controls="accordion-filter-1">
                            Product Categories
                            <svg class="accordion-button__icon type2" viewBox="0 0 10 6" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5.35668 0.159286C5.16235 -0.053094 4.83769 -0.0530941 4.64287 0.159286L0.147611 5.05963C-0.0492049 5.27473 -0.049205 5.62357 0.147611 5.83813C0.344427 6.05323 0.664108 6.05323 0.860924 5.83813L5 1.32706L9.13858 5.83867C9.33589 6.05378 9.65507 6.05378 9.85239 5.83867C10.0492 5.62357 10.0492 5.27473 9.85239 5.06018L5.35668 0.159286Z"/>
                            </svg>
                        </button>
                    </h5>
                    
                    <div id="accordion-filter-1" 
                         class="accordion-collapse collapse show border-0" 
                         aria-labelledby="accordion-heading-11" 
                         data-bs-parent="#categories-list">
                        <div class="accordion-body px-0 pb-0 pt-3">
                            <ul class="list list-unstyled mb-0">
                                {% for item in categories_with_subcategories %}
                                    <li class="list-item mb-2">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <a href="javascript:void(0)" 
                                               class="menu-link category-link py-1 flex-grow-1 {% if request.GET.category == item.category.id|stringformat:'i' %}fw-bold text-dark{% endif %}"
                                               data-category="{{ item.category.id }}">
                                                {{ item.category.name }}
                                                <span class="text-secondary ms-2">{{ item.category.product_count }}</span>
                                            </a>
                                            
                                            {% if item.subcategory_ids %}
                                                <button class="btn btn-link p-0 text-decoration-none subcategory-toggle" 
                                                        type="button" 
                                                        data-bs-toggle="collapse" 
                                                        data-bs-target="#subcategories-{{ item.category.id }}"
                                                        aria-expanded="{{ item.has_selected_subcategory|yesno:'true,false' }}">
                                                    <svg width="12" height="12" viewBox="0 0 10 6" fill="currentColor" class="subcategory-arrow">
                                                        <path d="M5.35668 0.159286C5.16235 -0.053094 4.83769 -0.0530941 4.64287 0.159286L0.147611 5.05963C-0.0492049 5.27473 -0.049205 5.62357 0.147611 5.83813C0.344427 6.05323 0.664108 6.05323 0.860924 5.83813L5 1.32706L9.13858 5.83867C9.33589 6.05378 9.65507 6.05378 9.85239 5.83867C10.0492 5.62357 10.0492 5.27473 9.85239 5.06018L5.35668 0.159286Z"/>
                                                    </svg>
                                                </button>
                                            {% endif %}
                                        </div>
                                        
                                        {% if item.subcategory_ids %}
                                            <div class="collapse {% if item.has_selected_subcategory %}show{% endif %}" 
                                                 id="subcategories-{{ item.category.id }}">
                                                <ul class="list list-unstyled ps-3 mt-1">
                                                    {% for subcategory in item.category.subcategories.all %}
                                                        <li>
                                                            <a href="javascript:void(0)" 
                                                               class="menu-link subcategory-link py-1 d-block {% if request.GET.subcategory == subcategory.id|stringformat:'i' %}fw-bold text-dark{% endif %}"
                                                               data-subcategory="{{ subcategory.id }}">
                                                                {{ subcategory.name }}
                                                                <span class="text-secondary ms-2">{{ subcategory.product_count }}</span>
                                                            </a>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                            
                            {% if request.GET.category or request.GET.subcategory %}
                                <button class="btn btn-link p-0 text-danger text-decoration-none fs-6 js-clear-categories">
                                    Clear
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIZES FILTER -->
<div class="accordion" id="size-filters">
    <div class="accordion-item mb-4 pb-3">
        <h5 class="accordion-header" id="accordion-heading-size">
            <button class="accordion-button p-0 border-0 fs-5 text-uppercase" 
                    type="button" 
                    data-bs-toggle="collapse" 
                    data-bs-target="#accordion-filter-size" 
                    aria-expanded="true" 
                    aria-controls="accordion-filter-size">
                Sizes
                <svg class="accordion-button__icon type2" viewBox="0 0 10 6" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5.35668 0.159286C5.16235 -0.053094 4.83769 -0.0530941 4.64287 0.159286L0.147611 5.05963C-0.0492049 5.27473 -0.049205 5.62357 0.147611 5.83813C0.344427 6.05323 0.664108 6.05323 0.860924 5.83813L5 1.32706L9.13858 5.83867C9.33589 6.05378 9.65507 6.05378 9.85239 5.83867C10.0492 5.62357 10.0492 5.27473 9.85239 5.06018L5.35668 0.159286Z"/>
                </svg>
            </button>
        </h5>
        
        <div id="accordion-filter-size" 
             class="accordion-collapse collapse show border-0" 
             aria-labelledby="accordion-heading-size" 
             data-bs-parent="#size-filters">
            <div class="accordion-body px-0 pb-0">
                <div class="d-flex flex-wrap">
                    {% for size in sizes %}
                        <a href="javascript:void(0)" 
                           class="swatch-size btn btn-sm mb-3 me-3 js-size-filter {% if size.id in selected_sizes %}active{% else %}btn-outline-light{% endif %}" 
                           data-size="{{ size.id }}"
                           title="{{ size.product_count }} products">
                            {{ size.name }}
                            <span class="size-count">{{ size.product_count }}</span>
                        </a>
                    {% endfor %}
                </div>
                
                {% if selected_sizes %}
                    <div class="mt-3">
                        <a href="javascript:void(0)" 
                           class="btn btn-sm btn-link text-danger p-0" 
                           id="clear-sizes">
                            Clear Sizes
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

            <!-- BRANDS FILTER -->
            <div class="accordion" id="brand-filters">
                <div class="accordion-item mb-4 pb-3">
                    <h5 class="accordion-header" id="accordion-heading-brand">
                        <button class="accordion-button p-0 border-0 fs-5 text-uppercase" 
                                type="button" 
                                data-bs-toggle="collapse" 
                                data-bs-target="#accordion-filter-brand" 
                                aria-expanded="true" 
                                aria-controls="accordion-filter-brand">
                            Brands
                            <svg class="accordion-button__icon type2" viewBox="0 0 10 6" xmlns="http://www.w3.org/2000/svg">
<path d="M5.35668 0.159286C5.16235 -0.053094 4.83769 -0.0530941 4.64287 0.159286L0.147611 5.05963C-0.0492049 5.27473 -0.049205 5.62357 0.147611 5.83813C0.344427 6.05323 0.664108 6.05323 0.860924 5.83813L5 1.32706L9.13858 5.83867C9.33589 6.05378 9.65507 6.05378 9.85239 5.83867C10.0492 5.62357 10.0492 5.27473 9.85239 5.06018L5.35668 0.159286Z"/>                            </svg>
                        </button>
                    </h5>
                    
                    <div id="accordion-filter-brand" 
                         class="accordion-collapse collapse show border-0" 
                         aria-labelledby="accordion-heading-brand" 
                         data-bs-parent="#brand-filters">
                        <div class="accordion-body px-0 pb-0">
                            <div class="search-field mb-3">
                                <input type="text" 
                                       class="search-field__input form-control form-control-sm border-light border-2" 
                                       placeholder="Search brands..." 
                                       id="brand-search">
                            </div>
                            
                            <div class="brand-scroll-container" style="max-height: 300px; overflow-y: auto;">
                                <ul class="list-unstyled mb-0" id="brand-list">
                                    {% for brand in ordered_brands %}
                                        <li class="mb-2">
                                            <div class="form-check d-flex align-items-center">
                                                <input class="form-check-input brand-checkbox" 
                                                       type="checkbox" 
                                                       value="{{ brand.id }}" 
                                                       id="brand-{{ brand.id }}"
                                                       {% if brand.id in selected_brands %}checked{% endif %}>
                                                <label class="form-check-label d-flex justify-content-between align-items-center w-100 ps-2" 
                                                       for="brand-{{ brand.id }}">
                                                    <span class="me-auto brand-name">{{ brand.name }}</span>
                                                    <span class="text-secondary">{{ brand.product_count }}</span>
                                                </label>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-3">
                                <button class="btn btn-sm btn-outline-dark" id="apply-brands">Apply</button>
                                {% if selected_brands %}
                                    <button class="btn btn-sm btn-link text-danger" id="clear-brands">Clear Brands</button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PRICE FILTER -->
            <div class="accordion" id="price-filters">
                <div class="accordion-item mb-4">
                    <h5 class="accordion-header mb-2" id="accordion-heading-price">
                        <button class="accordion-button p-0 border-0 fs-5 text-uppercase" 
                                type="button" 
                                data-bs-toggle="collapse" 
                                data-bs-target="#accordion-filter-price" 
                                aria-expanded="true" 
                                aria-controls="accordion-filter-price">
                            Price
                            <svg class="accordion-button__icon type2" viewBox="0 0 10 6" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5.35668 0.159286C5.16235 -0.053094 4.83769 -0.0530941 4.64287 0.159286L0.147611 5.05963C-0.0492049 5.27473 -0.049205 5.62357 0.147611 5.83813C0.344427 6.05323 0.664108 6.05323 0.860924 5.83813L5 1.32706L9.13858 5.83867C9.33589 6.05378 9.65507 6.05378 9.85239 5.83867C10.0492 5.62357 10.0492 5.27473 9.85239 5.06018L5.35668 0.159286Z"/>
                            </svg>
                        </button>
                    </h5>
                    
                    <div id="accordion-filter-price" 
                         class="accordion-collapse collapse show border-0" 
                         aria-labelledby="accordion-heading-price" 
                         data-bs-parent="#price-filters">
                        <input class="price-range-slider" 
                               type="text" 
                               name="price_range" 
                               value=""
                               data-slider-min="{{ global_min_price|default:10 }}" 
                               data-slider-max="{{ global_max_price|default:1000 }}" 
                               data-slider-step="5"
                               data-slider-value="[{% if min_price %}{{ min_price }}{% else %}{{ global_min_price|default:250 }}{% endif %}, {% if max_price %}{{ max_price }}{% else %}{{ global_max_price|default:450 }}{% endif %}]">
                        
                        <div class="price-range__info d-flex align-items-center mt-2">
                            <div class="me-auto">
                                <span class="text-secondary">Min Price: </span>
                                <span class="price-range__min">₹{{ min_price|default:global_min_price|floatformat:2 }}</span>
                            </div>
                            <div>
                                <span class="text-secondary">Max Price: </span>
                                <span class="price-range__max">₹{{ max_price|default:global_max_price|floatformat:2 }}</span>
                            </div>
                        </div>
                        
                        {% if min_price or max_price %}
                            <div class="mt-3">
                                <a href="javascript:void(0)" 
                                   class="btn btn-sm btn-link text-danger p-0" 
                                   id="clear-price">
                                    <i class="fas fa-times me-1"></i>Clear price range
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
        </div><!-- /.shop-sidebar -->

        <!-- MAIN SHOP CONTENT -->
        <div class="shop-list flex-grow-1">
            
            <!-- SLIDESHOW BANNER -->
            <div class="swiper-container js-swiper-slider slideshow slideshow_small slideshow_split"
                 data-settings='{"autoplay": {"delay": 5000},"slidesPerView": 1,"effect": "fade","loop": true,"pagination": {"el": ".slideshow-pagination","type": "bullets","clickable": true} }'>
                <div class="swiper-wrapper">
                    
                    <!-- Slide 1: Dresses -->
                    <div class="swiper-slide">
                        <div class="slide-split h-100 d-block d-md-flex overflow-hidden" style="background-color: #e9dee6ff;">
                            <div class="slide-split_text position-relative d-flex align-items-center" style="background-color: #e9dee6ff;">
                                <div class="slideshow-text container p-3 p-xl-5">
                                    <h2 class="text-uppercase section-title fw-normal mb-3 animate animate_fade animate_btt animate_delay-2">
                                        Women's <br><strong>DRESSES</strong>
                                    </h2>
                                    <p class="mb-0 animate animate_fade animate_btt animate_delay-5">
                                        From elegant evening gowns to casual day dresses, find the perfect dress for every occasion. Express your style with our curated collection.
                                    </p>
                                </div>
                            </div>
                            <div class="slide-split_media position-relative" style="background-color: #e9dee6ff;">
                                <div class="slideshow-bg" style="background-color: #e9dee6ff;">
                                    <img loading="lazy" 
                                         src="{% static 'user/assets/images/shop/d3.png' %}" 
                                         width="630" 
                                         height="450" 
                                         alt="Women's dresses collection" 
                                         class="slideshow-bg__img object-fit-cover">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Slide 2: Ethnic Wear -->
                    <div class="swiper-slide">
                        <div class="slide-split h-100 d-block d-md-flex overflow-hidden" style="background-color: #e9cfdbff;">
                            <div class="slide-split_text position-relative d-flex align-items-center" style="background-color: #e9cfdbff;">
                                <div class="slideshow-text container p-3 p-xl-5">
                                    <h2 class="text-uppercase section-title fw-normal mb-3 animate animate_fade animate_btt animate_delay-2">
                                        Ethnic <br><strong>WEAR</strong>
                                    </h2>
                                    <p class="mb-0 animate animate_fade animate_btt animate_delay-5">
                                        Embrace traditional elegance with our stunning collection of ethnic wear. From vibrant sarees to elegant kurtas, find your perfect cultural style.
                                    </p>
                                </div>
                            </div>
                            <div class="slide-split_media position-relative" style="background-color: #e9cfdbff;">
                                <div class="slideshow-bg" style="background-color: #e9cfdbff;">
                                    <img loading="lazy" 
                                         src="{% static 'user/assets/images/shop/e3.jpg' %}" 
                                         width="630" 
                                         height="450" 
                                         alt="Ethnic wear collection" 
                                         class="slideshow-bg__img object-fit-cover">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Slide 3: Oversized T-Shirts -->
                    <div class="swiper-slide">
                        <div class="slide-split h-100 d-block d-md-flex overflow-hidden" style="background-color: #dde4e6ff;">
                            <div class="slide-split_text position-relative d-flex align-items-center" style="background-color: #dde4e6ff;">
                                <div class="slideshow-text container p-3 p-xl-5">
                                    <h2 class="text-uppercase section-title fw-normal mb-3 animate animate_fade animate_btt animate_delay-2">
                                        Oversized <br><strong>T-SHIRTS</strong>
                                    </h2>
                                    <p class="mb-0 animate animate_fade animate_btt animate_delay-5">
                                        Comfort meets style with our oversized t-shirt collection. Perfect for casual days and street style looks that make a statement.
                                    </p>
                                </div>
                            </div>
                            <div class="slide-split_media position-relative" style="background-color: #dde4e6ff;">
                                <div class="slideshow-bg" style="background-color: #dde4e6ff;">
                                    <img loading="lazy" 
                                         src="{% static 'user/assets/images/shop/o8.jpg' %}" 
                                         width="630" 
                                         height="450" 
                                         alt="Oversized t-shirts collection" 
                                         class="slideshow-bg__img object-fit-cover">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                
                <div class="container p-3 p-xl-5">
                    <div class="slideshow-pagination d-flex align-items-center position-absolute bottom-0 mb-4 pb-xl-2"></div>
                </div>
            </div>

            <div class="mb-3 pb-2 pb-xl-3"></div>

            <!-- PRODUCT COUNT AND FILTER/SORT CONTROLS -->
            <div class="d-flex justify-content-between align-items-center mb-4 pb-md-2 flex-wrap">

  <div class="d-flex align-items-center mb-2 mb-md-0">
    {% if keyword %}
        <h2 class="search-results-title mb-0">
            Results for: <span>"{{ keyword }}"</span>
        </h2>
    {% elif similar_product_ids %}  <h2 class="search-results-title mb-0">
            Showing products visually similar to your upload
        </h2>
    {% elif image_search_status == 'no_results' %}
        <h2 class="search-results-title mb-0">
            Sorry, we couldn't find any close matches for your image.
        </h2>
    {% else %}
      <div class="breadcrumb mb-0 d-none d-md-block flex-grow-1">
        <div class="d-inline-flex align-items-center">
          <a href="{% url 'homepage' %}" class="menu-link menu-link_us-s text-uppercase fw-medium">Home</a>
          <span class="menu-link fw-medium px-2">/</span>
          <a href="{% url 'shop' %}" class="menu-link menu-link_us-s text-uppercase fw-medium">The Shop</a>
        </div>
      </div>
    {% endif %}

    <span class="product-count-badge">
      <i class="fas fa-box product-count-icon"></i>
      Showing <span class="count-number">{{ products.paginator.count }}</span> products
    </span>
  </div>

  <div class="d-flex align-items-center">
    <select class="shop-acs__select form-select w-auto border-0 py-0 order-1 order-md-0" 
            aria-label="Sort Items" 
            name="total-number" 
            id="sort-select">
      <option value="default" {% if sort == 'default' %}selected{% endif %}>Default Sorting</option>
      <option value="featured" {% if sort == 'featured' %}selected{% endif %}>Featured</option>
      <option value="a-z" {% if sort == 'a-z' %}selected{% endif %}>Alphabetically, A-Z</option>
      <option value="z-a" {% if sort == 'z-a' %}selected{% endif %}>Alphabetically, Z-A</option>
      <option value="price-low" {% if sort == 'price-low' %}selected{% endif %}>Price, low to high</option>
      <option value="price-high" {% if sort == 'price-high' %}selected{% endif %}>Price, high to low</option>
      <option value="date-old" {% if sort == 'date-old' %}selected{% endif %}>Date, old to new</option>
      <option value="date-new" {% if sort == 'date-new' %}selected{% endif %}>Date, new to old</option>
    </select>

    {% if request.GET.category or request.GET.subcategory or request.GET.size or request.GET.brand or request.GET.min_price or request.GET.max_price or request.GET.sort or keyword %}
      <button class="btn btn-link text-danger text-decoration-none fs-6 ms-3 order-2 order-md-1" id="clear-all-filters">
        <i class="fas fa-times me-1"></i>Clear All
      </button>
    {% endif %}

    <div class="shop-asc__seprator mx-3 bg-light d-none d-md-block order-md-0"></div>

    <div class="shop-filter d-flex align-items-center order-0 order-md-3 d-lg-none">
      <button class="btn-link btn-link_f d-flex align-items-center ps-0 js-open-aside" data-aside="shopFilter">
        <svg class="d-inline-block align-middle me-2" width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg">
          <use href="#icon_filter" />
        </svg>
        <span class="text-uppercase fw-medium d-inline-block align-middle">Filter</span>
      </button>
    </div>
  </div>

</div>

            <!-- PRODUCT GRID -->
            <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4" id="products-grid">
                {% for product in products %}
                    <div class="product-card-wrapper">
                        <div class="product-card product-card_style9 border rounded-3 mb-3 mb-md-4 mb-xxl-5">
                            <div class="position-relative pb-3">
                                
                                <!-- Image Gallery Container -->
                                <div class="pc__img-wrapper pc__img-wrapper_wide3" style="padding-bottom: 25%; position: relative;">
                                    <div class="product-gallery swiper h-100 w-100" style="position: absolute; top: 0; left: 0;">
                                        <div class="swiper-wrapper h-100">

                                            <!-- Base Image -->
                                            <div class="swiper-slide h-100">
                                              <a href="{% url 'product_detail' product.id %}">
                                              {% if product.base_image %}
                                              <img loading="lazy" 
                                                src="{{ product.base_image.url }}" 
                                                 class="pc__img w-100 h-100 object-fit-contain" 
                                                  alt="{{ product.name|default:'Product Image' }}">
                                              {% else %}
                                              <img loading="lazy" 
                                                src="{% static 'user/assets/images/shop/no-image-available.jpg' %}" 
                                                class="pc__img w-100 h-100 object-fit-contain" 
                                                alt="No image available">
                                              {% endif %}
                                              </a>
                                            </div>
                                            
                                            <!-- Gallery Images -->
                                            {% for gallery_image in product.product_gallery_set.all|dictsort:"image_order" %}
                                                {% if not gallery_image.image_path.url|is_duplicate:product.base_image.url %}
                                                    <div class="swiper-slide h-100">
                                                        <a href="{% url 'product_detail' product.id %}">
                                                            <img loading="lazy" 
                                                                 src="{{ gallery_image.image_path.url }}" 
                                                                 class="pc__img w-100 h-100 object-fit-contain">
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            {% endfor %}
                                            
                                        </div>
                                        
                                        <!-- Navigation Arrows -->
                                        <div class="swiper-button-next"></div>
                                        <div class="swiper-button-prev"></div>
                                    </div>
                                </div>
                                
                                <!-- Product Actions -->
                                <div class="anim_appear-bottom position-absolute w-100 text-center">
                                    <button class="btn btn-round btn-hover-red border-0 text-uppercase me-2 js-add-cart" 
        onclick="window.location.href='{% url 'quick_add_to_cart' product.id %}'" 
        title="Add To Cart">
                                        <svg class="d-inline-block" width="14" height="14" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <use href="#icon_cart" />
                                        </svg>
                                    </button>

                                    <button class="btn btn-round btn-hover-red border-0 text-uppercase me-2 js-quick-view" 
        data-bs-toggle="modal" 
        data-bs-target="#quickView{{ product.id }}"
        title="Quick view">
    <svg class="d-inline-block" width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
        <use href="#icon_view" />
    </svg>
</button>

                                    <button class="btn btn-round btn-hover-red border-0 text-uppercase js-add-wishlist" 
                                            onclick="window.location.href='{% url 'quick_add_to_wishlist' product.id %}'" 
                                            title="Add To Wishlist">
                                        <svg width="14" height="14" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <use href="#icon_heart" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <div class="pc__info position-relative">
                                <p class="pc__category">{{ product.subcategory_id.name }}</p>
                                <h6 class="pc__title">
                                    <a href="{% url 'product_detail' product.id %}">{{ product.name }}</a>
                                </h6>
                                <div class="product-card__price d-flex">
                                    <span class="money price fs-5">₹{{ product.price }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- PAGINATION -->
            <nav class="shop-pages d-flex justify-content-between mt-3" aria-label="Page navigation">
                {% if products.has_previous %}
                    <a href="javascript:void(0)" 
                       class="btn-link d-inline-flex align-items-center js-page-link"
                       data-page="{{ products.previous_page_number }}">
                        <svg class="me-1" width="7" height="11" viewBox="0 0 7 11" xmlns="http://www.w3.org/2000/svg">
                            <use href="#icon_prev_sm" />
                        </svg>
                        <span class="fw-medium">PREV</span>
                    </a>
                {% else %}
                    <span class="btn-link d-inline-flex align-items-center disabled">
                        <svg class="me-1" width="7" height="11" viewBox="0 0 7 11" xmlns="http://www.w3.org/2000/svg">
                            <use href="#icon_prev_sm" />
                        </svg>
                        <span class="fw-medium">PREV</span>
                    </span>
                {% endif %}
                
                <ul class="pagination mb-0">
                    {% for num in products.paginator.page_range %}
                        {% if products.number == num %}
                            <li class="page-item">
                                <a class="btn-link px-1 mx-2 btn-link_active js-page-link" 
                                   href="javascript:void(0)"
                                   data-page="{{ num }}">
                                    {{ num }}
                                </a>
                            </li>
                        {% elif num > products.number|add:'-3' and num < products.number|add:'3' %}
                            <li class="page-item">
                                <a class="btn-link px-1 mx-2 js-page-link" 
                                   href="javascript:void(0)"
                                   data-page="{{ num }}">
                                    {{ num }}
                                </a>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
                
                {% if products.has_next %}
                    <a href="javascript:void(0)" 
                       class="btn-link d-inline-flex align-items-center js-page-link"
                       data-page="{{ products.next_page_number }}">
                        <span class="fw-medium me-1">NEXT</span>
                        <svg width="7" height="11" viewBox="0 0 7 11" xmlns="http://www.w3.org/2000/svg">
                            <use href="#icon_next_sm" />
                        </svg>
                    </a>
                {% else %}
                    <span class="btn-link d-inline-flex align-items-center disabled">
                        <span class="fw-medium me-1">NEXT</span>
                        <svg width="7" height="11" viewBox="0 0 7 11" xmlns="http://www.w3.org/2000/svg">
                            <use href="#icon_next_sm" />
                        </svg>
                    </span>
                {% endif %}
            </nav>
            
        </div><!-- /.shop-list -->
        
    </section>

<!-- Quick View -->
    {% for product in products %}
    <div class="modal fade" id="quickView{{product.id}}" tabindex="-1">
    <div class="modal-dialog quick-view modal-dialog-centered">
      <div class="modal-content">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        <div class="product-single">
          <div class="product-single__media m-0">
            <div class="product-single__image position-relative w-100">
              <div class="swiper-container js-swiper-slider"
                data-settings='{
                  "slidesPerView": 1,
                  "slidesPerGroup": 1,
                  "effect": "none",
                  "loop": false,
                  "navigation": {
                    "nextEl": ".modal-dialog.quick-view .product-single__media .swiper-button-next",
                    "prevEl": ".modal-dialog.quick-view .product-single__media .swiper-button-prev"
                  }
                }'>
                  <div class="swiper-wrapper">
                    <div class="swiper-slide product-single__image-item">
                    {% if product.base_image %}
      <img loading="lazy" 
           src="{{ product.base_image.url }}" 
           class="pc__img w-100 h-100 object-fit-contain"
           alt="{{ product.name|default:'Product Image' }}">
    {% else %}
      <img loading="lazy" 
           src="{% static 'user/assets/images/shop/no-image-available.jpg' %}" 
           class="pc__img w-100 h-100 object-fit-contain" 
           alt="No image available">
    {% endif %}
                    </div>
                    <!-- Gallery Images -->
                    {% for gallery_image in product.ordered_gallery_images %}
                      {% if gallery_image.image_path.url != product.base_image.url %}
                      <div class="swiper-slide product-single__image-item">
                        <img loading="lazy" src="{{ gallery_image.image_path.url }}" alt="{{ product.name }}">
                      </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                  {% if product.ordered_gallery_images|length > 0 %}
                  <div class="swiper-button-prev"><svg width="7" height="11" viewBox="0 0 7 11" xmlns="http://www.w3.org/2000/svg"><use href="#icon_prev_sm"/></svg></div>
                  <div class="swiper-button-next"><svg width="7" height="11" viewBox="0 0 7 11" xmlns="http://www.w3.org/2000/svg"><use href="#icon_next_sm"/></svg></div>
                  {% endif %}
                </div>
              </div>
            </div>
            <div class="product-single__detail">
              <h1 class="product-single__name">{{ product.name }}</h1>
              <div class="product-single__price">
                <span class="current-price">₹{{ product.price }}</span>
              </div>
              <div class="product-single__short-desc">
                <p>{{ product.description|truncatewords:30 }}</p>
              </div>
              <form class="add-to-cart-form" name="addtocart-form" method="post" action="{% url 'add_to_cart_quick_view' product.id %}">
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ product.id }}">
                <input type="hidden" name="variant_id" class="selected-variant" value="" required>
                <input type="hidden" name="keep_cart_open" value="1">
                <div class="product-single__swatches">
                  <div class="product-swatch text-swatches">
                    <label>Sizes</label>
                    <div class="swatch-list">
                      {% for variant in product.variants_list %}
                      <input type="radio" name="size" id="swatch-{{ product.id }}-{{ variant.id }}">
                      <label class="swatch js-swatch {% if variant.stock_quantity <= 0 %}disabled{% endif %}"
                             data-variant-id="{{ variant.id }}"
                             data-price="{{ product.price|add:variant.additional_price }}" 
                             data-sku="{{ variant.sku }}"                                        
                             data-stock="{{ variant.stock_quantity }}"
                             for="swatch-{{ product.id }}-{{ variant.id }}" 
                             aria-label="Size {{ variant.size_id.name }}{% if variant.stock_quantity <= 0 %} - out of stock{% endif %}" 
                             data-bs-toggle="tooltip" 
                             data-bs-placement="top" 
                             title="{{ variant.size_id.name }}">
                          {{ variant.size_id.name }}{% if variant.stock_quantity <= 0 %}<span class="size-out">(X)</span>{% endif %}
                      </label>
                      {% empty %}
                      <p class="text-muted">No sizes available</p>
                      {% endfor %}
                    </div>
                  </div>
                  <div class="product-swatch color-swatches">
                    <label>Color</label>
                    <div class="swatch-list">
                      <h6 class="mb-1">{{ product.color }}</h6>
                    </div>
                  </div>
                </div>
                <div class="product-single__addtocart">
                  <div class="qty-control position-relative">
                    <input type="number" name="quantity" value="1" min="1" class="qty-control__number text-center">
                    <div class="qty-control__reduce">-</div>
                    <div class="qty-control__increase">+</div>
                  </div>
                  <button type="submit" class="btn btn-primary btn-addtocart" {% if not product.in_stock %}disabled{% endif %}>
                    {% if product.in_stock %}Add to Cart{% else %}Out of Stock{% endif %}
                  </button>
                </div>
              </form>
              <div class="product-single__addtolinks">
                <form method="post" action="{% url 'add_to_wishlist_quick_view' product.id %}" class="d-inline">
    {% csrf_token %}
    <button type="submit" class="menu-link menu-link_us-s add-to-wishlist border-0 bg-transparent p-0">
        <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <use href="#icon_heart" {% if product.in_wishlist %}fill="black"{% endif %}/>
        </svg>
        <span>{% if product.in_wishlist %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}</span>
    </button>
</form>
              </div>
              <div class="product-single__meta-info mb-0">
                <div class="meta-item">
                  <label>SKU:</label>
                  <span class="sku-display">{{ product.productvariant_set.first.sku }}</span>
                </div>
                <div class="meta-item">
                  <label>Categories:</label>
                  <span><a href="{% url 'shop' %}?subcategory={{ product.subcategory_id.id }}">
                    {{ product.subcategory_id.name }}
                  </a></span>
                </div>
                <div class="meta-item">
                  <label>Tags:</label>
                  <span>
                    {% for tag in product.tags.all %}
                      <a href="{% url 'shop' %}?tag={{ tag.id }}" class="text-decoration-underline">
                        {{ tag.tag }}{% if not forloop.last %}, {% endif %}
                      </a>
                    {% endfor %}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /.modal-dialog -->
    </div><!-- /.quickview position-fixed -->
{% endfor %}
</main>
{% endblock %}

{% block script %}
<!-- JavaScript Libraries -->
<script src="{% static 'user/assets/js/plugins/jquery.min.js' %}"></script>
<script src="{% static 'user/assets/js/plugins/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'user/assets/js/plugins/bootstrap-slider.min.js' %}"></script>
<script src="{% static 'user/assets/js/plugins/swiper.min.js' %}"></script>
<script src="{% static 'user/assets/js/plugins/countdown.js' %}"></script>
<script src="{% static 'user/assets/js/theme.js' %}"></script>
<script>
$(document).ready(function() {
    // Initialize tooltips
    $('[data-bs-toggle="tooltip"]').tooltip();
    
    // Initialize each quick view modal
    $('.quick-view').each(function() {
        const modal = $(this);
        
        // Auto-select the first available size when modal is shown
        modal.on('shown.bs.modal', function() {
            autoSelectFirstSize(modal);
        });
        
        // Size selection functionality for this modal
        modal.find('.js-swatch').on('click', function(e) {
            e.preventDefault();
            
            // Skip if disabled (out of stock)
            if ($(this).hasClass('disabled')) {
                return;
            }
            
            // Remove active class from all swatches in this modal
            modal.find('.js-swatch').removeClass('active');
            
            // Add active class to clicked swatch
            $(this).addClass('active');
            
            // Get variant data
            const variantId = $(this).data('variant-id');
            const price = $(this).data('price');
            const sku = $(this).data('sku');
            const stock = $(this).data('stock');
            
            // Update hidden input with selected variant for this modal
            modal.find('.selected-variant').val(variantId);
            
            // Update price display for this modal
            modal.find('.product-single__price .current-price').text('₹' + price);
            
            // Update SKU display for this modal
            modal.find('.sku-display').text(sku);
            
            // Reset quantity to 1 when changing size
            modal.find('input[name="quantity"]').val(1);
            
            // Enable/disable add to cart button based on stock
            const addToCartBtn = modal.find('.btn-addtocart');
            if (stock > 0) {
                addToCartBtn.prop('disabled', false).text('Add to Cart');
            } else {
                addToCartBtn.prop('disabled', true).text('Out of Stock');
            }
        });
        
        // Add to cart form submission for this modal
        modal.find('.add-to-cart-form').on('submit', function(e) {
            e.preventDefault();
            
            // Check if a size is selected
            if (!modal.find('.selected-variant').val()) {
                alert('Please select a size');
                return false;
            }
            
            // Validate quantity
            const quantity = parseInt(modal.find('input[name="quantity"]').val());
            if (isNaN(quantity) || quantity < 1) {
                alert('Please enter a valid quantity');
                return false;
            }
            
            // Validate quantity against stock
            const selectedVariant = modal.find('.js-swatch.active');
            const maxStock = selectedVariant.data('stock');
            
            if (quantity > maxStock) {
                alert('Cannot add more than available stock (' + maxStock + ' items available)');
                return false;
            }
            
            // Submit the form via standard POST (no AJAX as requested)
            this.submit();
        });
    });
    
    // Auto-select the first available size in a modal
    function autoSelectFirstSize(modal) {
        // Find all available sizes (not disabled)
        const availableSizes = modal.find('.js-swatch:not(.disabled)');
        
        if (availableSizes.length > 0) {
            // Remove active class from all swatches first
            modal.find('.js-swatch').removeClass('active');
            
            // Add active class to first available swatch
            const firstAvailableSize = availableSizes.first();
            firstAvailableSize.addClass('active');
            
            // Trigger the selection logic
            const variantId = firstAvailableSize.data('variant-id');
            const price = firstAvailableSize.data('price');
            const sku = firstAvailableSize.data('sku');
            const stock = firstAvailableSize.data('stock');
            
            // Update hidden input with selected variant
            modal.find('.selected-variant').val(variantId);
            
            // Update price display
            modal.find('.product-single__price .current-price').text('₹' + price);
            
            // Update SKU display
            modal.find('.sku-display').text(sku);
            
            // Enable/disable add to cart button based on stock
            const addToCartBtn = modal.find('.btn-addtocart');
            if (stock > 0) {
                addToCartBtn.prop('disabled', false).text('Add to Cart');
            } else {
                addToCartBtn.prop('disabled', true).text('Out of Stock');
            }
            
            console.log('Auto-selected size:', firstAvailableSize.text().trim(), 'with variant ID:', variantId);
        } else {
            // If no sizes available, disable the add to cart button
            modal.find('.btn-addtocart').prop('disabled', true).text('Out of Stock');
            console.log('No available sizes found for this product');
        }
    }
    
    // Also auto-select sizes when page loads for any modals that might be pre-rendered
    $('.quick-view').each(function() {
        autoSelectFirstSize($(this));
    });
});

// The rest of your existing script remains the same...
// Utility function to update URL with parameters
function updateUrlParams(params) {
    const urlParams = new URLSearchParams(window.location.search);
    
    // Update parameters
    for (const [key, value] of Object.entries(params)) {
        if (value === null || value === '' || value === undefined) {
            urlParams.delete(key);
        } else if (Array.isArray(value)) {
            urlParams.delete(key);
            if (value.length > 0) {
                value.forEach(v => urlParams.append(key, v));
            }
        } else {
            urlParams.set(key, value);
        }
    }
    
    // Remove page parameter when changing filters
    urlParams.delete('page');
    
    // Build the new URL
    const newUrl = window.location.pathname + '?' + urlParams.toString();
    window.location.href = newUrl;
}

// Clear price filter
document.getElementById('clear-price')?.addEventListener('click', function() {
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.delete('min_price');
    urlParams.delete('max_price');
    urlParams.delete('page');
    window.location.search = urlParams.toString();
});

// Clear gender filter
document.querySelector('.js-clear-gender')?.addEventListener('click', function() {
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.delete('gender');
    urlParams.delete('page');
    window.location.search = urlParams.toString();
});

// Clear category filter
document.querySelector('.js-clear-categories')?.addEventListener('click', function() {
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.delete('category');
    urlParams.delete('subcategory');
    urlParams.delete('page');
    window.location.search = urlParams.toString();
});

// Clear sizes filter
document.getElementById('clear-sizes')?.addEventListener('click', function() {
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.delete('size');
    urlParams.delete('page');
    window.location.search = urlParams.toString();
});

// Clear brands filter
document.getElementById('clear-brands')?.addEventListener('click', function() {
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.delete('brand');
    urlParams.delete('page');
    window.location.search = urlParams.toString();
});

// Clear all filters
document.getElementById('clear-all-filters')?.addEventListener('click', function() {
    window.location.href = "{% url 'shop' %}";
});

// Gender filter
document.querySelectorAll('.gender-link').forEach(link => {
    link.addEventListener('click', function() {
        const gender = this.dataset.gender;
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('gender', gender);
        urlParams.delete('page');
        window.location.search = urlParams.toString();
    });
});

// Category filter
document.querySelectorAll('.category-link').forEach(link => {
    link.addEventListener('click', function() {
        const category = this.dataset.category;
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('category', category);
        urlParams.delete('subcategory');
        urlParams.delete('page');
        window.location.search = urlParams.toString();
    });
});

// Subcategory filter
document.querySelectorAll('.subcategory-link').forEach(link => {
    link.addEventListener('click', function() {
        const subcategory = this.dataset.subcategory;
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('subcategory', subcategory);
        urlParams.delete('page');
        window.location.search = urlParams.toString();
    });
});

// Size filter
document.querySelectorAll('.js-size-filter').forEach(button => {
    button.addEventListener('click', function() {
        const sizeId = this.dataset.size;
        const urlParams = new URLSearchParams(window.location.search);
        
        // Get current sizes
        const currentSizes = urlParams.getAll('size');
        
        // Toggle this size
        if (currentSizes.includes(sizeId)) {
            // Remove this size
            const newSizes = currentSizes.filter(id => id !== sizeId);
            urlParams.delete('size');
            newSizes.forEach(size => urlParams.append('size', size));
        } else {
            // Add this size
            urlParams.append('size', sizeId);
        }
        
        urlParams.delete('page');
        window.location.search = urlParams.toString();
    });
});

// Brand filter
document.getElementById('apply-brands')?.addEventListener('click', function() {
    const selectedBrands = [];
    document.querySelectorAll('.brand-checkbox:checked').forEach(checkbox => {
        selectedBrands.push(checkbox.value);
    });
    
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.delete('brand');
    selectedBrands.forEach(brand => urlParams.append('brand', brand));
    urlParams.delete('page');
    window.location.search = urlParams.toString();
});

// Sort functionality
document.getElementById('sort-select')?.addEventListener('change', function() {
    const sortValue = this.value;
    const urlParams = new URLSearchParams(window.location.search);
    urlParams.set('sort', sortValue);
    urlParams.delete('page');
    window.location.search = urlParams.toString();
});

// Pagination
document.querySelectorAll('.js-page-link').forEach(link => {
    link.addEventListener('click', function() {
        const page = this.dataset.page;
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('page', page);
        window.location.search = urlParams.toString();
    });
});

// Initialize active states when page loads
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    
    // Initialize sizes
    const selectedSizes = urlParams.getAll('size');
    document.querySelectorAll('.js-size-filter').forEach(button => {
        if (selectedSizes.includes(button.dataset.size)) {
            button.classList.add('active');
        }
    });
    
    // Initialize gender
    const selectedGender = urlParams.get('gender');
    document.querySelectorAll('.gender-link').forEach(link => {
        if (link.dataset.gender === selectedGender) {
            link.classList.add('fw-bold', 'text-dark');
        }
    });
    
    // Initialize categories
    const currentCategory = urlParams.get('category');
    const currentSubcategory = urlParams.get('subcategory');
    
    document.querySelectorAll('.category-link').forEach(link => {
        if (link.dataset.category === currentCategory) {
            link.classList.add('fw-bold', 'text-dark');
        }
    });
    
    document.querySelectorAll('.subcategory-link').forEach(link => {
        if (link.dataset.subcategory === currentSubcategory) {
            link.classList.add('fw-bold', 'text-dark');
        }
    });
    
    // Initialize brands
    const selectedBrands = urlParams.getAll('brand');
    document.querySelectorAll('.brand-checkbox').forEach(checkbox => {
        if (selectedBrands.includes(checkbox.value)) {
            checkbox.checked = true;
            checkbox.closest('li').classList.add('active-brand');
        }
    });
    
    // Initialize price slider if it exists
    if (typeof $('.price-range-slider').slider === 'function') {
        $('.price-range-slider').slider({
            tooltip_position: 'top',
            tooltip_split: true,
            formatter: function(value) {
                return '₹' + value.toLocaleString('en-IN');
            },
            min: parseFloat("{{ global_min_price|default:0 }}"),
            max: parseFloat("{{ global_max_price|default:10000 }}"),
            value: [
                {% if request.GET.min_price %}{{ request.GET.min_price }}{% else %}{{ global_min_price|default:0 }}{% endif %},
                {% if request.GET.max_price %}{{ request.GET.max_price }}{% else %}{{ global_max_price|default:10000 }}{% endif %}
            ]
        }).on('change', function(e) {
            const values = e.value.newValue || e.value;
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('min_price', values[0]);
            urlParams.set('max_price', values[1]);
            urlParams.delete('page');
            window.location.search = urlParams.toString();
        });
    }
});

// Product Gallery Swiper Initialization
document.addEventListener('DOMContentLoaded', function() {
    // Initialize galleries
    document.querySelectorAll('.product-gallery').forEach(function(gallery) {
        const slides = gallery.querySelectorAll('.swiper-slide');
        const nextBtn = gallery.querySelector('.swiper-button-next');
        const prevBtn = gallery.querySelector('.swiper-button-prev');
        
        // Set data attribute for CSS
        gallery.setAttribute('data-slides', slides.length);
        
        // Only initialize if we have multiple slides
        if (slides.length > 1) {
            new Swiper(gallery, {
                loop: true,
                observer: true,
                observeParents: true,
                navigation: {
                    nextEl: nextBtn,
                    prevEl: prevBtn,
                }
            });
        } else {
            // Hide arrows if not needed
            if (nextBtn) nextBtn.style.display = 'none';
            if (prevBtn) prevBtn.style.display = 'none';
        }
    });
});

// Function to open cart drawer
function openCartDrawer() {
    $('#cartDrawer').addClass('aside_visible');
    $('.page-overlay').addClass('page-overlay_visible');
    $('body').addClass('overflow-hidden');
}

// Check if cart drawer should be opened on page load
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('open_cart_drawer') === 'true') {
    // Open the cart drawer
    openCartDrawer();
    
    // Clean up URL (remove the parameter but keep other filters)
    const cleanUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + window.location.search.replace('open_cart_drawer=true', '').replace(/&$/, '').replace(/\?$/, '');
    window.history.replaceState({}, document.title, cleanUrl);
}
</script>
{% endblock %}