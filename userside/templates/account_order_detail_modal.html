<div class="modal-dialog modal-xl noir-modal">
<div class="modal-content">
<div class="modal-body">

    <div class="order-sidebar">
        <div class="sidebar-header">
            <h2>Order Details</h2>
            <p>Order #{{ order.order_number }}</p>
        </div>

        <ul class="tracking-stepper">
            {% with order.status as status %}
            <li class="tracking-step {% if status in 'processing,confirmed,shipped,delivered' %}completed{% endif %} {% if status == 'processing' %}active{% endif %}">
                <strong>Order Processing</strong>
                <small class="d-block">{{ order.order_date|date:"M j, Y" }}</small>
            </li>
            <li class="tracking-step {% if status in 'confirmed,shipped,delivered' %}completed{% endif %} {% if status == 'confirmed' %}active{% endif %}">
                <strong>Confirmed</strong>
            </li>
            <li class="tracking-step {% if status in 'shipped,delivered' %}completed{% endif %} {% if status == 'shipped' %}active{% endif %}">
                <strong>Shipped</strong>
            </li>
            <li class="tracking-step {% if status == 'delivered' %}completed{% endif %} {% if status == 'delivered' %}active{% endif %}">
                <strong>Delivered</strong>
            </li>
            {% endwith %}
        </ul>

        <div class="sidebar-details">
            <h5>Shipping To</h5>
            <p>{{ shipping_address.full_name }}<br>{{ shipping_address.address_line_1 }}<br>{{ shipping_address.city }}, {{ shipping_address.state }} {{ shipping_address.pincode }}</p>

            <h5>Payment</h5>
            <p>Paid ₹{{ order.total_amount }} via {{ payment.payment_method }}</p>
        </div>

        <div class="sidebar-footer">
    {% if order.status in "processing,confirmed" %}
        
        <form action="{% url 'cancel_order' order.id %}" method="POST" class="d-flex gap-3 w-100">
            {% csrf_token %}
            <button 
                type="submit" 
                class="btn btn-outline-danger flex-grow-1"
                onclick="return confirm('Are you sure you want to cancel this order? This action cannot be undone.')">
                Cancel Order
            </button>
            <a href="#" class="btn btn-light flex-grow-1" target="_blank">Download Invoice</a>
        </form>

    {% elif order.status in "shipped,delivered" %}
        <p class="text-secondary small w-100">This item has been shipped. If you wish to cancel, you can refuse the package at the time of delivery.</p>
        <a href="#" class="btn btn-light flex-grow-1" target="_blank">Download Invoice</a>
    {% else %}
        <button type="button" class="btn btn-outline-light flex-grow-1" data-bs-dismiss="modal">Close</button>
        <a href="#" class="btn btn-light flex-grow-1" target="_blank">Download Invoice</a>
    {% endif %}
</div>
    </div>

    <div class="order-main-content">
        <h3 class="main-content-header">Your Items ({{ order_items|length }})</h3>
        
        <div class="product-list">
            {% for item in order_items %}
            <div class="product-list-item">
                <img src="{{ item.product_variant_id.product_id.base_image.url }}" class="product-list-item-img" alt="{{ item.product_name }}">
                <div class="product-item-details">
                    <h4>{{ item.product_name }}</h4>
                    <p>Size: {{ item.product_variant_id.size_id.name }}</p>
                    <p>Qty: {{ item.quantity }}</p>
                </div>
                <div class="product-item-price">
                    ₹{{ item.total_price }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

</div>
</div>
</div>