{% extends 'base1.html' %}
{% load static %}

{% block title %}
  Account-Orders | VibeDrobe
{% endblock %}

{% block css %}
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="flexkit" />

  <link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon" />
  <link rel="preconnect" href="https://fonts.gstatic.com/" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Allura&amp;display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="{% static 'user/assets/css/plugins/swiper.min.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% static 'user/assets/css/plugins/jquery.fancybox.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% static 'user/assets/css/style.css' %}" type="text/css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    .order-status {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 500;
      text-transform: capitalize;
    }
    
    /* Grey for Processing */
    .order-status--processing {
      background-color: #e2e3e5;
      color: #383d41;
    }
    
    /* Yellow for Confirmed */
    .order-status--confirmed {
      background-color: #fff3cd;
      color: #856404;
    }
    
    /* Blue for Shipped */
    .order-status--shipped {
      background-color: #cce5ff;
      color: #004085;
    }
    
    /* Green for Delivered */
    .order-status--delivered {
      background-color: #d4edda;
      color: #155724;
    }
    
    /* Red for Cancelled */
    .order-status--cancelled {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>

<style>
    /* ============================================
       DESIGN 2.2: RESPONSIVE NOIR
    ============================================ */

    /* --- 1. Dark Theme Design Tokens --- */
    :root {
        --noir-bg-primary: #1C1D21; 
        --noir-bg-secondary: #2C2D31; 
        --noir-border-color: #404040;
        --noir-accent: #D4AF37; 
        --noir-text-primary: #F0F0F0;
        --noir-text-secondary: #A9A9A9;
        --noir-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        --font-serif: "Georgia", "Times New Roman", serif;
    }

    /* --- 2. Modal Core & Asymmetrical Layout --- */
    .noir-modal .modal-content {
        background: none; border: none;
        box-shadow: var(--noir-shadow); border-radius: 12px;
    }

    .noir-modal .modal-body {
        padding: 0; display: flex;
        min-height: 550px;
        max-height: 85vh; 
        overflow: hidden;
    }

    /* Left Panel: Sidebar for Tracking & Info */
    .order-sidebar {
        width: 38%; min-width: 380px;
        background-color: var(--noir-bg-primary); padding: 2.5rem;
        display: flex; flex-direction: column;
        animation: slideInLeft 0.6s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    }

    /* Right Panel: Main Content for Items */
    .order-main-content {
        width: 62%;
        background-color: var(--noir-bg-secondary); padding: 2.5rem;
        overflow-y: auto; 
        animation: fadeIn 0.8s ease-out forwards;
    }

    .sidebar-header h2 {
        font-family: var(--font-serif); font-weight: normal; font-size: 2.25rem;
        color: var(--noir-text-primary); margin-bottom: 0.5rem;
    }
    .sidebar-header p {
        color: var(--noir-text-secondary); font-size: 1rem; margin-bottom: 2.5rem;
    }

    /* --- 3. Vertical Tracking Stepper --- */
    .tracking-stepper {
        list-style: none; padding-left: 1rem; margin-bottom: 2.5rem; position: relative;
    }
    .tracking-stepper::before {
        content: ''; position: absolute; left: 0; top: 0.5rem; bottom: 0.5rem;
        width: 2px; background-color: var(--noir-border-color);
    }
    .tracking-step {
        margin-bottom: 2rem; position: relative; padding-left: 2rem;
    }
    .tracking-step:last-child { margin-bottom: 0; }
    .tracking-step::before {
        content: ''; position: absolute; left: -7px; top: 5px; width: 16px; height: 16px;
        border-radius: 50%; background-color: var(--noir-bg-primary);
        border: 2px solid var(--noir-border-color); transition: all 0.4s ease;
    }
    .tracking-step strong {
        color: var(--noir-text-secondary); font-weight: 500; transition: color 0.4s ease;
    }
    .tracking-step.completed::before, .tracking-step.active::before {
        background-color: var(--noir-accent); border-color: var(--noir-accent);
    }
    .tracking-step.completed strong, .tracking-step.active strong {
        color: var(--noir-text-primary);
    }
    .tracking-step.active::before {
        transform: scale(1.2); box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
    }
    .tracking-step small { color: var(--noir-text-secondary); }

    /* --- 4. Sidebar Details & Footer --- */
    .sidebar-details h5 {
        font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;
        color: var(--noir-text-secondary); margin-bottom: 0.75rem;
    }
    .sidebar-details p {
        color: var(--noir-text-primary); line-height: 1.6; margin-bottom: 1.5rem;
    }
    .sidebar-footer {
        margin-top: auto; padding-top: 1rem;
        display: flex; gap: 1rem; width: 100%;
    }

    /* --- 5. Main Content Product List --- */
    .main-content-header {
        font-family: var(--font-serif); font-weight: normal; font-size: 1.75rem;
        color: var(--noir-text-primary); border-bottom: 1px solid var(--noir-border-color);
        padding-bottom: 1rem; margin-bottom: 1rem;
    }
    .product-list-item {
        display: flex; gap: 1.5rem; padding: 1.5rem 0;
        border-bottom: 1px solid var(--noir-border-color);
    }
    .product-list-item-img {
        width: 90px; height: 115px; object-fit: cover; border-radius: 8px;
    }
    .product-item-details h4 {
        font-weight: 500; font-size: 1.1rem;
        color: var(--noir-text-primary); margin: 0 0 0.5rem 0;
    }
    .product-item-details p { color: var(--noir-text-secondary); margin: 0; }
    .product-item-price {
        margin-left: auto; text-align: right; font-weight: 500;
        font-size: 1.1rem; color: var(--noir-text-primary);
    }

    /* --- 6. Animations --- */
    @keyframes slideInLeft {
        from { transform: translateX(-50px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    /* --- [NEW] 7. Responsive Design (Mobile) --- */
    @media (max-width: 991.98px) {
        .noir-modal .modal-dialog {
            /* Allow modal to use more screen space on mobile */
            max-width: none;
            margin: 0.5rem;
        }

        .noir-modal .modal-body {
            /* Stack the panels vertically */
            flex-direction: column; 
            /* Let the body scroll as one unit */
            overflow-y: auto; 
            /* Remove height constraints for mobile */
            min-height: auto;
            max-height: 95vh;
        }

        .order-sidebar,
        .order-main-content {
            /* Both panels take full width */
            width: 100%; 
            /* Remove min-width to prevent overflow */
            min-width: auto; 
            /* Adjust padding for smaller screens */
            padding: 1.5rem; 
        }

        .order-main-content {
            /* Remove individual scrolling for the content panel */
            overflow-y: visible;
        }

        .sidebar-header h2 {
            font-size: 1.75rem;
        }
    }

</style>

{% endblock %}

{% block content %}
  <main>
    <div class="mb-4 pb-4"></div>
    <section class="my-account container">
      <h2 class="page-title">Orders</h2>
      <div class="row">
        <div class="col-lg-3">
          <ul class="account-nav">
            <li>
              <a href="{% url 'account_dashboard' %}" class="menu-link menu-link_us-s">Dashboard</a>
            </li>
            <li>
              <a href="{% url 'account_orders' %}" class="menu-link menu-link_us-s menu-link_active">Orders</a>
            </li>
            <li>
              <a href="{% url 'account_addresses' %}" class="menu-link menu-link_us-s">Addresses</a>
            </li>
            <li>
              <a href="{% url 'account_details' %}" class="menu-link menu-link_us-s">Account Details</a>
            </li>
            <li>
              <a href="{% url 'logout' %}" class="menu-link menu-link_us-s">Logout</a>
            </li>
          </ul>
        </div>
        <div class="col-lg-9">
          <div class="page-content my-account__orders-list">
            <table class="orders-table">
              <thead>
                <tr>
                  <th>Order</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Total</th>
                  <th>Items</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for order_data in order_list %}
                  <tr>
                    <td>#{{ order_data.order.order_number }}</td>
                    <td>{{ order_data.order.order_date|date:'F j, Y' }}</td>
                    <td>
                      <span class="order-status order-status--{{ order_data.order.status|lower }}">{{ order_data.order.get_status_display }}</span>
                    </td>
                    <td>â‚¹{{ order_data.order.total_amount }}</td>
                    <td>{{ order_data.item_count }} item(s)</td>
                    <td>
                      <!-- Payment status available if needed -->
                      {% if order_data.payment %}
                        <small class="text-muted">{{ order_data.payment.status }}</small>
                      {% endif %}

                      <button class="btn btn-primary view-order-btn" data-bs-toggle="modal" data-bs-target="#orderModal" data-order-id="{{ order_data.order.id }}">VIEW</button>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Order Details Modal -->
    <div class="modal fade" id="orderModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <!-- Modal content will be loaded via AJAX -->
        </div>
      </div>
    </div>
  </main>
{% endblock %}

{% block script %}
  <!-- External JavaScripts -->
  <script src="{% static 'user/assets/js/plugins/jquery.min.js' %}"></script>
  <script src="{% static 'user/assets/js/plugins/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'user/assets/js/plugins/bootstrap-slider.min.js' %}"></script>

  <script src="{% static 'user/assets/js/plugins/swiper.min.js' %}"></script>
  <script src="{% static 'user/assets/js/plugins/countdown.js' %}"></script>
  <script src="{% static 'user/assets/js/plugins/jquery.fancybox.js' %}"></script>

  <!-- Footer Scripts -->
  <script src="{% static 'user/assets/js/theme.js' %}"></script>!<!-- ajax script for loading order detail modal -->
  <script>
    $(document).ready(function () {
      $('#orderModal').on('show.bs.modal', function (event) {
        const button = $(event.relatedTarget)
        const orderId = button.data('order-id')
        const modal = $(this)
    
        modal.find('.modal-content').html(`
          <div class="modal-header">
            <h5 class="modal-title">Loading Order Details...</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        `)
    
        // Update this line to match your actual URL pattern
        $.get(`/account-orders/${orderId}/`, function (data) {
          modal.find('.modal-content').html(data)
        }).fail(function (xhr, status, error) {
          console.error('Error loading order details:', status, error)
          modal.find('.modal-content').html(`
            <div class="alert alert-danger m-3">
              Failed to load order details. Please try again.
            </div>
          `)
        })
      })
    })
  </script>
{% endblock %}
